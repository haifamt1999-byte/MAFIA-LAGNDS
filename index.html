<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مافيا الأساطير - لعبة التحدي والذكاء الاجتماعي</title>
    <meta name="description" content="لعبة المافيا العربية الأفضل، تحدِ ذكي بين فريق المافيا والمواطنين. العب مع أصدقائك واختبر مهاراتك في التحليل والتخطيط.">
    <meta name="keywords" content="لعبة المافيا، ألعاب عربية، ألعاب جماعية، ألعاب ذكاء، العاب اجتماعية">
    <meta name="author" content="زياد العوني">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-dark: #0a0e17;
            --primary: #1a2238;
            --secondary: #2a3655;
            --accent: #ff4757;
            --accent-dark: #ff3838;
            --citizen: #4ecdc4;
            --mafia: #ff6b6b;
            --doctor: #1dd1a1;
            --detective: #54a0ff;
            --sniper: #ff9f43;
            --godfather: #a55eea;
            --online: #9b59b6;
            --text: #ffffff;
            --text-secondary: #bdc3c7;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
            --night: #2c3e50;
            --day: #3498db;
            --card-bg: rgba(26, 34, 56, 0.9);
            --modal-bg: rgba(10, 14, 23, 0.97);
            --gold: #ffd700;
            --silver: #c0c0c0;
            --bronze: #cd7f32;
            --judge: #ffd700;
            --timer-red: #ff4757;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Cairo', sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(255, 71, 87, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(78, 205, 196, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(84, 160, 255, 0.05) 0%, transparent 50%);
            z-index: -1;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
            padding: 15px;
        }

        header {
            background: linear-gradient(135deg, rgba(26, 34, 56, 0.9), rgba(42, 54, 85, 0.9));
            border-radius: 20px;
            padding: 15px 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--accent), var(--citizen), var(--detective), var(--doctor));
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            flex: 1;
            transition: transform 0.3s ease;
        }

        .logo:hover {
            transform: scale(1.02);
        }

        .logo-icon {
            font-size: 2rem;
            color: var(--accent);
            filter: drop-shadow(0 0 8px rgba(255, 71, 87, 0.5));
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .logo-text h1 {
            font-size: 1.8rem;
            background: linear-gradient(135deg, 
                var(--citizen) 0%, 
                var(--detective) 30%, 
                var(--doctor) 60%, 
                var(--mafia) 90%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 900;
            margin-bottom: 3px;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .logo-text p {
            color: var(--text-secondary);
            font-size: 0.9rem;
            letter-spacing: 0.5px;
        }

        .copyright {
            text-align: center;
            margin-top: 12px;
            color: var(--text-secondary);
            font-size: 0.8rem;
            width: 100%;
            opacity: 0.8;
        }

        .info-links {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .info-link {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            padding: 5px 10px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .info-link:hover {
            color: var(--accent);
            background: rgba(255, 255, 255, 0.05);
            transform: translateY(-2px);
        }

        .controls {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .control-btn {
            background: linear-gradient(135deg, var(--secondary), var(--primary));
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text);
            width: 42px;
            height: 42px;
            border-radius: 12px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .control-btn:hover {
            background: linear-gradient(135deg, var(--accent), var(--accent-dark));
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(255, 71, 87, 0.4);
        }

        .page {
            display: none;
            min-height: 100vh;
            padding: 20px;
            animation: fadeIn 0.5s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .page-header {
            background: linear-gradient(135deg, rgba(26, 34, 56, 0.9), rgba(42, 54, 85, 0.9));
            border-radius: 20px;
            padding: 15px 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .page-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--accent), var(--citizen), var(--detective), var(--doctor));
        }

        .page-content {
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        .page-footer {
            text-align: center;
            margin-top: 30px;
            color: var(--text-secondary);
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .navigation-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 14px 24px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
            position: relative;
            overflow: hidden;
            min-width: 160px;
        }

        .nav-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }

        .nav-btn:hover::before {
            left: 100%;
        }

        .nav-btn-primary {
            background: linear-gradient(135deg, var(--accent), var(--accent-dark));
            color: white;
            box-shadow: 0 6px 20px rgba(255, 71, 87, 0.4);
        }

        .nav-btn-primary:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(255, 71, 87, 0.6);
        }

        .nav-btn-secondary {
            background: linear-gradient(135deg, var(--citizen), #2a9d8f);
            color: white;
            box-shadow: 0 6px 20px rgba(78, 205, 196, 0.4);
        }

        .nav-btn-secondary:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(78, 205, 196, 0.6);
        }

        .nav-btn-back {
            background: linear-gradient(135deg, var(--secondary), var(--primary));
            color: white;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .nav-btn-back:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.4);
        }

        .nav-btn-home {
            background: linear-gradient(135deg, var(--online), #8e44ad);
            color: white;
            box-shadow: 0 6px 20px rgba(155, 89, 182, 0.4);
        }

        .nav-btn-home:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(155, 89, 182, 0.6);
        }

        .nav-btn-repeat {
            background: linear-gradient(135deg, var(--gold), #ffb347);
            color: white;
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4);
        }

        .nav-btn-repeat:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(255, 215, 0, 0.6);
        }

        .start-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 80vh;
            text-align: center;
            padding: 40px 20px;
        }

        .start-title {
            font-size: 4rem;
            font-weight: 900;
            margin-bottom: 20px;
            background: linear-gradient(135deg, 
                var(--citizen) 0%, 
                var(--detective) 25%, 
                var(--doctor) 50%, 
                var(--mafia) 75%, 
                var(--godfather) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            animation: titleGlow 3s infinite alternate, gradientMove 8s ease infinite;
            background-size: 200% 200%;
        }

        @keyframes titleGlow {
            0% { text-shadow: 0 0 20px rgba(78, 205, 196, 0.5); }
            25% { text-shadow: 0 0 30px rgba(84, 160, 255, 0.7); }
            50% { text-shadow: 0 0 30px rgba(29, 209, 161, 0.7); }
            75% { text-shadow: 0 0 30px rgba(255, 107, 107, 0.7); }
            100% { text-shadow: 0 0 30px rgba(165, 94, 234, 0.7); }
        }

        @keyframes gradientMove {
            0% { 
                background-position: 0% 50%;
            }
            50% { 
                background-position: 100% 50%;
            }
            100% { 
                background-position: 0% 50%;
            }
        }

        .start-subtitle {
            font-size: 1.5rem;
            color: var(--text-secondary);
            margin-bottom: 50px;
            max-width: 600px;
            line-height: 1.8;
        }

        .start-buttons {
            display: flex;
            gap: 25px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 30px;
        }

        .start-btn {
            padding: 22px 45px;
            border: none;
            border-radius: 20px;
            font-size: 1.3rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.4s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            justify-content: center;
            position: relative;
            overflow: hidden;
            min-width: 220px;
            flex-direction: column;
        }

        .start-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }

        .start-btn:hover::before {
            left: 100%;
        }

        .start-btn-primary {
            background: linear-gradient(135deg, var(--accent), var(--accent-dark));
            color: white;
            box-shadow: 0 10px 30px rgba(255, 71, 87, 0.5);
        }

        .start-btn-primary:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 20px 40px rgba(255, 71, 87, 0.7);
        }

        .start-btn-quick {
            background: linear-gradient(135deg, var(--success), #27ae60);
            color: white;
            box-shadow: 0 10px 30px rgba(46, 204, 113, 0.5);
        }

        .start-btn-quick:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 20px 40px rgba(46, 204, 113, 0.7);
        }

        .start-btn-secondary {
            background: linear-gradient(135deg, var(--citizen), #2a9d8f);
            color: white;
            box-shadow: 0 10px 30px rgba(78, 205, 196, 0.5);
        }

        .start-btn-secondary:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 20px 40px rgba(78, 205, 196, 0.7);
        }

        .start-btn-special {
            background: linear-gradient(135deg, var(--detective), #3d7ea6);
            color: white;
            box-shadow: 0 10px 30px rgba(84, 160, 255, 0.5);
        }

        .start-btn-special:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 20px 40px rgba(84, 160, 255, 0.7);
        }

        .start-btn-gold {
            background: linear-gradient(135deg, var(--gold), #ffb347);
            color: white;
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.5);
        }

        .start-btn-gold:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 20px 40px rgba(255, 215, 0, 0.7);
        }

        .start-btn-online {
            background: linear-gradient(135deg, var(--online), #8e44ad);
            color: white;
            box-shadow: 0 10px 30px rgba(155, 89, 182, 0.5);
        }

        .start-btn-online:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 20px 40px rgba(155, 89, 182, 0.7);
        }

        .save-badge {
            background: rgba(255, 215, 0, 0.2);
            color: var(--gold);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-top: 5px;
            border: 1px solid rgba(255, 215, 0, 0.3);
            display: inline-block;
        }

        .start-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-top: 60px;
            width: 100%;
            max-width: 1000px;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.08);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-10px);
            background: rgba(255, 255, 255, 0.12);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }

        .feature-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            background: linear-gradient(135deg, var(--accent), var(--citizen));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .feature-title {
            font-size: 1.4rem;
            margin-bottom: 15px;
            color: var(--text);
        }

        .feature-desc {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .section {
            background: var(--card-bg);
            border-radius: 18px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .section-title {
            font-size: 1.5rem;
            color: var(--text);
            margin-bottom: 18px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--accent);
            position: relative;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -2px;
            right: 0;
            width: 80px;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--accent));
        }

        .player-input-container {
            display: flex;
            gap: 12px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .player-input {
            flex: 1;
            min-width: 220px;
            position: relative;
        }

        .player-input input {
            width: 100%;
            padding: 14px 16px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            color: var(--text);
            font-size: 1rem;
            transition: all 0.3s ease;
            max-width: 100%;
        }

        .player-input input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(255, 71, 87, 0.2);
            background: rgba(255, 255, 255, 0.12);
        }

        .player-input input::placeholder {
            color: var(--text-secondary);
        }

        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent), var(--accent-dark));
            color: white;
            box-shadow: 0 6px 20px rgba(255, 71, 87, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(255, 71, 87, 0.6);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--citizen), #2a9d8f);
            color: white;
            box-shadow: 0 6px 20px rgba(78, 205, 196, 0.4);
        }

        .btn-secondary:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(78, 205, 196, 0.6);
        }

        .btn-load {
            background: linear-gradient(135deg, var(--detective), #3d7ea6);
            color: white;
            box-shadow: 0 6px 20px rgba(84, 160, 255, 0.4);
        }

        .btn-load:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(84, 160, 255, 0.6);
        }

        .btn-save {
            background: linear-gradient(135deg, var(--success), #27ae60);
            color: white;
            box-shadow: 0 6px 20px rgba(46, 204, 113, 0.4);
        }

        .btn-save:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(46, 204, 113, 0.6);
        }

        .player-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .player-tag {
            background: linear-gradient(135deg, var(--secondary), var(--primary));
            padding: 10px 16px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: fadeIn 0.5s ease;
            max-width: 200px;
        }

        .player-tag:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
        }

        .player-tag button {
            background: none;
            border: none;
            color: var(--accent);
            cursor: pointer;
            font-size: 0.9rem;
            transition: transform 0.3s ease;
        }

        .player-tag button:hover {
            transform: scale(1.1);
        }

        .character-icon-large {
            font-size: 2.5rem;
            margin-bottom: 15px;
            display: inline-block;
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: 3px solid var(--role-color, var(--accent));
            box-shadow: 0 0 20px rgba(255, 71, 87, 0.3);
        }

        .character-icon-large i {
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }

        .characters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }

        .character-card {
            background: linear-gradient(135deg, var(--secondary), var(--primary));
            padding: 20px;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        .character-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--role-color, var(--accent));
        }

        .character-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 16px 32px rgba(0, 0, 0, 0.4);
        }

        .character-card.mafia { --role-color: var(--mafia); }
        .character-card.godfather { --role-color: var(--godfather); }
        .character-card.citizen { --role-color: var(--citizen); }
        .character-card.doctor { --role-color: var(--doctor); }
        .character-card.detective { --role-color: var(--detective); }
        .character-card.sniper { --role-color: var(--sniper); }
        .character-card.judge { --role-color: var(--judge); }

        .character-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .character-icon {
            font-size: 2.5rem;
            color: var(--role-color, var(--accent));
            filter: drop-shadow(0 0 8px var(--role-color, var(--accent)));
        }

        .character-name {
            font-size: 1.3rem;
            font-weight: 800;
            color: var(--text);
        }

        .character-description {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.5;
            margin-bottom: 12px;
        }

        .character-details {
            background: rgba(0, 0, 0, 0.3);
            padding: 12px;
            border-radius: 10px;
            margin-top: 12px;
            border-right: 3px solid var(--role-color, var(--accent));
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease;
        }

        .character-details.active {
            max-height: 400px;
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            font-size: 0.85rem;
        }

        .detail-item:last-child {
            margin-bottom: 0;
        }

        .detail-icon {
            color: var(--role-color, var(--accent));
            font-size: 0.8rem;
        }

        .game-controls {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .role-section {
            text-align: center;
            padding: 30px 20px;
            position: relative;
        }

        .role-icon-large {
            font-size: 6rem;
            margin-bottom: 20px;
            background: linear-gradient(135deg, var(--accent), var(--citizen), var(--detective));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.4));
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        .role-title {
            font-size: 2.5rem;
            margin-bottom: 15px;
            background: linear-gradient(135deg, var(--text), var(--text-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .role-description {
            font-size: 1.4rem;
            margin-bottom: 20px;
            color: var(--text-secondary);
            line-height: 1.6;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .player-name {
            font-size: 2.2rem;
            font-weight: bold;
            margin-bottom: 25px;
            color: var(--accent);
            padding: 15px 25px;
            background: rgba(255, 71, 87, 0.1);
            border-radius: 16px;
            border: 2px solid rgba(255, 71, 87, 0.3);
            display: inline-block;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            animation: pulse 2s infinite;
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .game-header {
            text-align: center;
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 18px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        .game-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--accent), var(--citizen), var(--detective), var(--doctor));
        }

        .phase-indicator {
            font-size: 3rem;
            font-weight: bold;
            padding: 15px 30px;
            border-radius: 50px;
            margin-bottom: 20px;
            display: inline-block;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }

        .phase-indicator::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transform: translateX(-100%);
        }

        .phase-indicator:hover::before {
            animation: shine 1.5s;
        }

        @keyframes shine {
            100% { transform: translateX(100%); }
        }

        .phase-night {
            background: linear-gradient(135deg, var(--night), #1a2530);
            color: white;
            border: 2px solid rgba(44, 62, 80, 0.5);
        }

        .phase-day {
            background: linear-gradient(135deg, var(--day), #2980b9);
            color: white;
            border: 2px solid rgba(52, 152, 219, 0.5);
        }

        /* المؤقت باللون الأحمر */
        .timer {
            font-size: 3.5rem;
            font-weight: bold;
            margin: 20px 0;
            color: var(--timer-red);
            text-shadow: 0 2px 8px rgba(255, 71, 87, 0.5);
            font-family: 'Courier New', monospace;
            animation: pulse 1s infinite;
        }

        .phase-description {
            font-size: 1.5rem;
            color: var(--text-secondary);
            background: rgba(255, 255, 255, 0.05);
            padding: 14px 24px;
            border-radius: 12px;
            display: inline-block;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .players-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 12px;
            margin: 20px 0;
        }

        .player-card {
            background: linear-gradient(135deg, var(--secondary), var(--primary));
            padding: 12px;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }

        .player-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: translateX(-100%);
        }

        .player-card:hover::before {
            animation: shine 1.5s;
        }

        .player-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.4);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .player-card.selected {
            border-color: var(--accent);
            background: linear-gradient(135deg, var(--accent), var(--accent-dark));
            transform: translateY(-4px);
            box-shadow: 0 10px 20px rgba(255, 71, 87, 0.5);
        }

        .player-card.dead {
            opacity: 0.5;
            background: linear-gradient(135deg, #475569, #374151);
            transform: scale(0.9);
            cursor: not-allowed;
        }

        .player-card.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            border: 2px dashed var(--danger);
        }

        .player-role {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 6px;
        }

        .vote-count {
            background: var(--accent);
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            margin: 6px auto 0;
            box-shadow: 0 2px 6px rgba(255, 71, 87, 0.5);
        }

        .results-container {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 18px;
            margin: 20px 0;
            border-right: 4px solid var(--accent);
            box-shadow: inset 0 2px 12px rgba(0, 0, 0, 0.4);
        }

        .day-title {
            text-align: center;
            font-size: 1.7rem;
            margin-bottom: 20px;
            color: var(--accent);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            position: relative;
            display: inline-block;
            left: 50%;
            transform: translateX(-50%);
            padding: 0 16px;
        }

        .day-title::before, .day-title::after {
            content: '✦';
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            color: var(--accent);
            font-size: 1.2rem;
        }

        .day-title::before {
            right: -8px;
        }

        .day-title::after {
            left: -8px;
        }

        .result-item {
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 14px;
            padding: 14px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            border-right: 3px solid var(--accent);
            transition: transform 0.3s ease;
        }

        .result-item:hover {
            transform: translateX(-8px);
        }

        .result-item:last-child {
            margin-bottom: 0;
        }

        .btn-back {
            background: linear-gradient(135deg, var(--secondary), var(--primary));
            color: white;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .btn-back:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.4);
        }

        .btn-skip {
            background: linear-gradient(135deg, var(--warning), #e67e22);
            color: white;
            box-shadow: 0 6px 20px rgba(243, 156, 18, 0.4);
        }

        .btn-skip:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(243, 156, 18, 0.6);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: var(--modal-bg);
            padding: 30px;
            border-radius: 24px;
            max-width: 480px;
            width: 90%;
            text-align: center;
            box-shadow: 0 24px 48px rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            animation: modalAppear 0.5s ease;
        }

        @keyframes modalAppear {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        .modal-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--accent), var(--citizen), var(--detective));
        }

        .modal-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: var(--text);
            background: linear-gradient(135deg, var(--accent), var(--citizen));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .modal-message {
            font-size: 1.1rem;
            margin-bottom: 25px;
            line-height: 1.6;
            color: var(--text-secondary);
        }

        .message {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 18px 28px;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
            z-index: 1001;
            animation: slideIn 0.4s ease, slideOut 0.4s ease 4.6s forwards;
            border-left: 4px solid rgba(255, 255, 255, 0.5);
            font-size: 1.2rem;
        }

        .message.warning {
            background: var(--warning);
        }

        .message.error {
            background: var(--danger);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 5s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.2; }
            50% { opacity: 1; }
        }

        .confetti {
            position: fixed;
            width: 12px;
            height: 12px;
            background: var(--accent);
            opacity: 0;
            z-index: 1002;
        }

        @keyframes confettiFall {
            0% { 
                transform: translateY(-80px) rotate(0deg); 
                opacity: 1;
            }
            100% { 
                transform: translateY(800px) rotate(720deg); 
                opacity: 0;
            }
        }

        .phase-progress {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            position: relative;
        }

        .phase-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
        }

        .phase-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 8px;
            border: 2px solid var(--text-secondary);
            transition: all 0.3s ease;
        }

        .phase-circle.active {
            background: var(--accent);
            border-color: var(--accent);
            transform: scale(1.1);
        }

        .phase-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-align: center;
        }

        .phase-connector {
            position: absolute;
            top: 20px;
            height: 2px;
            background: var(--text-secondary);
            z-index: 1;
        }

        .phase-connector.active {
            background: var(--accent);
        }

        .voting-results {
            background: rgba(255, 255, 255, 0.08);
            padding: 20px;
            border-radius: 16px;
            margin: 20px 0;
            border-right: 4px solid var(--accent);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }
        
        .vote-result-item {
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 14px;
            padding: 14px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            border-right: 3px solid var(--accent);
            transition: transform 0.3s ease;
        }
        
        .vote-result-item:hover {
            transform: translateX(-8px);
        }
        
        .vote-result-item:last-child {
            margin-bottom: 0;
        }
        
        .vote-result-icon {
            font-size: 1.5rem;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .vote-result-details {
            flex: 1;
        }
        
        .vote-result-name {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .vote-result-count {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .vote-result-executed {
            background: linear-gradient(135deg, var(--danger), #c0392b);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-top: 5px;
            display: inline-block;
        }
        
        .vote-result-saved {
            background: linear-gradient(135deg, var(--success), #27ae60);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-top: 5px;
            display: inline-block;
        }

        .victory-screen {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, rgba(26, 34, 56, 0.95), rgba(42, 54, 85, 0.95));
            border-radius: 24px;
            margin: 20px 0;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            position: relative;
            overflow: hidden;
        }
        
        .victory-screen::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: linear-gradient(90deg, var(--accent), var(--citizen), var(--detective), var(--doctor));
        }
        
        .victory-icon {
            font-size: 6rem;
            margin-bottom: 25px;
            animation: bounce 2s infinite;
        }
        
        .victory-title {
            font-size: 3.5rem;
            font-weight: 900;
            margin-bottom: 20px;
            text-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }
        
        .victory-mafia {
            background: linear-gradient(135deg, var(--mafia), var(--godfather));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .victory-citizen {
            background: linear-gradient(135deg, var(--citizen), var(--doctor));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .victory-subtitle {
            font-size: 1.5rem;
            color: var(--text-secondary);
            margin-bottom: 30px;
            line-height: 1.6;
        }
        
        .victory-players {
            background: rgba(255, 255, 255, 0.08);
            padding: 25px;
            border-radius: 16px;
            margin: 25px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: right;
        }
        
        .victory-players-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: var(--accent);
            font-weight: bold;
        }
        
        .victory-player {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .victory-player:last-child {
            border-bottom: none;
        }
        
        .victory-player-name {
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .victory-player-role {
            color: var(--text-secondary);
        }
        
        .victory-player-alive {
            color: var(--success);
            font-weight: bold;
        }
        
        .victory-player-dead {
            color: var(--danger);
            text-decoration: line-through;
        }
        
        .victory-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }
        
        .victory-stat {
            background: rgba(255, 255, 255, 0.08);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .victory-stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .victory-stat-mafia {
            color: var(--mafia);
        }
        
        .victory-stat-citizen {
            color: var(--citizen);
        }
        
        .victory-stat-label {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .current-role-player {
            font-size: 1.8rem;
            font-weight: bold;
            margin: 15px 0;
            color: var(--accent);
            padding: 12px 20px;
            background: rgba(255, 71, 87, 0.1);
            border-radius: 12px;
            border: 2px solid rgba(255, 71, 87, 0.2);
            display: inline-block;
        }

        .role-display-container {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, rgba(26, 34, 56, 0.95), rgba(42, 54, 85, 0.95));
            border-radius: 24px;
            margin: 20px 0;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            position: relative;
            overflow: hidden;
        }
        
        .role-display-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: linear-gradient(90deg, var(--accent), var(--citizen), var(--detective), var(--doctor));
        }
        
        .role-display-icon {
            font-size: 8rem;
            margin-bottom: 30px;
            filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.4));
            animation: bounce 2s infinite;
        }
        
        .role-display-title {
            font-size: 3rem;
            font-weight: 900;
            margin-bottom: 20px;
            text-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }
        
        .role-display-player {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 25px 0;
            color: var(--accent);
            padding: 20px 40px;
            background: rgba(255, 71, 87, 0.1);
            border-radius: 20px;
            border: 3px solid rgba(255, 71, 87, 0.2);
            display: inline-block;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            animation: pulse 2s infinite;
            max-width: 400px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .role-display-description {
            font-size: 1.5rem;
            color: var(--text-secondary);
            margin-bottom: 30px;
            line-height: 1.7;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .about-container {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, rgba(26, 34, 56, 0.95), rgba(42, 54, 85, 0.95));
            border-radius: 24px;
            margin: 20px 0;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            position: relative;
            overflow: hidden;
        }
        
        .about-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: linear-gradient(90deg, var(--accent), var(--citizen), var(--detective), var(--doctor));
        }
        
        .about-icon {
            font-size: 6rem;
            margin-bottom: 30px;
            color: var(--accent);
            filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.4));
            animation: bounce 2s infinite;
        }
        
        .about-title {
            font-size: 3rem;
            font-weight: 900;
            margin-bottom: 20px;
            background: linear-gradient(135deg, var(--accent), var(--citizen), var(--detective));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }
        
        .about-content {
            font-size: 1.3rem;
            line-height: 1.8;
            color: var(--text-secondary);
            max-width: 800px;
            margin: 0 auto;
            text-align: right;
            direction: rtl;
        }
        
        .about-section {
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .about-section-title {
            font-size: 1.8rem;
            color: var(--accent);
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .team-member {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
        }
        
        .team-member:last-child {
            margin-bottom: 0;
        }
        
        .team-member-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent), var(--citizen));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            color: white;
            flex-shrink: 0;
        }
        
        .team-member-info {
            flex: 1;
            text-align: right;
        }
        
        .team-member-name {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--text);
            margin-bottom: 5px;
        }
        
        .team-member-role {
            font-size: 1.1rem;
            color: var(--accent);
            margin-bottom: 8px;
        }
        
        .team-member-desc {
            font-size: 1rem;
            color: var(--text-secondary);
            line-height: 1.6;
        }
        
        .about-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .about-feature {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .about-feature:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        
        .about-feature-icon {
            font-size: 2.5rem;
            color: var(--accent);
            margin-bottom: 15px;
        }
        
        .about-feature-title {
            font-size: 1.3rem;
            color: var(--text);
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .about-feature-desc {
            font-size: 1rem;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* الأنماط الجديدة للإصدار 1.5 */
        
        /* صفحة تسليم الأدوار */
        .player-name-large {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 15px 0;
            color: white;
            padding: 15px 30px;
            background: linear-gradient(135deg, var(--secondary), var(--primary));
            border-radius: 20px;
            border: 3px solid rgba(255, 71, 87, 0.3);
            display: inline-block;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            animation: pulse 2s infinite;
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* صفحة عرض الدور */
        .role-display-icon-large {
            font-size: 8rem;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 180px;
            height: 180px;
            border-radius: 50%;
            background: linear-gradient(135deg, 
                var(--citizen) 0%, 
                var(--detective) 25%, 
                var(--doctor) 50%, 
                var(--mafia) 75%, 
                var(--godfather) 100%);
            border: 6px solid white;
            box-shadow: 
                0 0 40px rgba(78, 205, 196, 0.4),
                0 0 60px rgba(84, 160, 255, 0.3),
                0 0 80px rgba(29, 209, 161, 0.2);
            margin-left: auto;
            margin-right: auto;
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .role-player-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: 4px solid var(--accent);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 20px auto;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
            position: relative;
            overflow: hidden;
        }

        .role-player-circle::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: rotate(45deg);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%) rotate(45deg); }
            100% { transform: translateX(100%) rotate(45deg); }
        }

        .player-circle-name {
            font-size: 1.8rem;
            font-weight: bold;
            color: white;
            text-align: center;
            margin-bottom: 10px;
            z-index: 2;
        }

        .player-circle-role {
            font-size: 1.2rem;
            color: var(--accent);
            background: rgba(255, 71, 87, 0.1);
            padding: 6px 15px;
            border-radius: 20px;
            z-index: 2;
        }

        .role-info-card {
            background: rgba(255, 255, 255, 0.08);
            padding: 25px;
            border-radius: 20px;
            margin: 25px auto;
            max-width: 500px;
            border-left: 5px solid var(--accent);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .role-info-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            border-radius: 50%;
        }

        .role-info-icon {
            font-size: 2.5rem;
            color: var(--accent);
            margin-bottom: 15px;
            text-align: center;
        }

        /* صفحة تسليم الحكم */
        .judge-handover-section {
            text-align: center;
            padding: 40px 20px;
        }

        .judge-icon-large {
            font-size: 7rem;
            color: var(--judge);
            margin-bottom: 25px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 160px;
            height: 160px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 215, 0, 0.1));
            border: 5px solid var(--judge);
            box-shadow: 0 0 35px rgba(255, 215, 0, 0.4);
            animation: bounce 2s infinite;
        }

        .judge-title {
            font-size: 2.5rem;
            color: var(--judge);
            margin-bottom: 25px;
            text-shadow: 0 2px 10px rgba(255, 215, 0, 0.3);
        }

        .judge-info-card {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 215, 0, 0.05));
            padding: 25px;
            border-radius: 20px;
            margin: 25px auto;
            max-width: 400px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        .judge-info-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .judge-info-header i {
            font-size: 2rem;
            color: var(--judge);
        }

        .judge-info-header h3 {
            color: white;
            font-size: 1.5rem;
        }

        .judge-responsibilities {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .judge-responsibilities li {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            color: white;
        }

        .judge-responsibilities li i {
            color: var(--judge);
            font-size: 1.2rem;
        }

        .judge-description {
            font-size: 1.3rem;
            color: var(--text-secondary);
            margin: 20px auto;
            max-width: 500px;
            line-height: 1.6;
        }

        /* تخصيص الألوان لكل دور */
        .role-display-icon-large.mafia {
            background: linear-gradient(135deg, var(--mafia), #ff4757);
            box-shadow: 0 0 40px rgba(255, 107, 107, 0.6);
        }

        .role-display-icon-large.godfather {
            background: linear-gradient(135deg, var(--godfather), #8e44ad);
            box-shadow: 0 0 40px rgba(165, 94, 234, 0.6);
        }

        .role-display-icon-large.citizen {
            background: linear-gradient(135deg, var(--citizen), #2a9d8f);
            box-shadow: 0 0 40px rgba(78, 205, 196, 0.6);
        }

        .role-display-icon-large.doctor {
            background: linear-gradient(135deg, var(--doctor), #1abc9c);
            box-shadow: 0 0 40px rgba(29, 209, 161, 0.6);
        }

        .role-display-icon-large.detective {
            background: linear-gradient(135deg, var(--detective), #3d7ea6);
            box-shadow: 0 0 40px rgba(84, 160, 255, 0.6);
        }

        .role-display-icon-large.sniper {
            background: linear-gradient(135deg, var(--sniper), #ff9f43);
            box-shadow: 0 0 40px rgba(255, 159, 67, 0.6);
        }

        .role-display-icon-large.judge {
            background: linear-gradient(135deg, var(--judge), #ffd700);
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.6);
        }

        /* أزرار المؤقت المحسنة */
        .timer-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }

        .timer-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .timer-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        /* تحسينات للجوال */
        @media (max-width: 768px) {
            .page {
                padding: 10px;
            }
            
            .start-title {
                font-size: 2.5rem;
            }
            
            .start-subtitle {
                font-size: 1.2rem;
            }
            
            .start-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .start-btn {
                width: 100%;
                max-width: 300px;
                padding: 18px 30px;
                font-size: 1.2rem;
            }
            
            .start-features {
                grid-template-columns: 1fr;
            }
            
            .player-input-container {
                flex-direction: column;
            }
            
            .player-input {
                min-width: 100%;
            }
            
            .characters-grid, .players-grid {
                grid-template-columns: 1fr;
            }
            
            .game-controls {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .role-icon-large {
                font-size: 4rem;
            }
            
            .role-title {
                font-size: 1.7rem;
            }
            
            .phase-indicator {
                font-size: 1.6rem;
                padding: 12px 24px;
            }
            
            .timer {
                font-size: 2.8rem;
            }
            
            .navigation-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .nav-btn {
                width: 100%;
                max-width: 300px;
            }
            
            .player-card {
                padding: 14px;
            }
            
            .player-name {
                font-size: 1.8rem;
            }
            
            .phase-description {
                font-size: 1.2rem;
            }
            
            /* تحسينات الإصدار 1.5 للجوال */
            .player-name-large {
                font-size: 1.8rem;
                padding: 12px 20px;
                max-width: 250px;
            }
            
            .role-display-icon-large {
                width: 140px;
                height: 140px;
                font-size: 6rem;
            }
            
            .role-player-circle {
                width: 150px;
                height: 150px;
            }
            
            .player-circle-name {
                font-size: 1.4rem;
            }
            
            .judge-icon-large {
                width: 120px;
                height: 120px;
                font-size: 5rem;
            }
            
            .judge-title {
                font-size: 1.8rem;
            }
        }

        /* تخصيص المؤقتات */
        .day-timer {
            color: var(--timer-red);
            text-shadow: 0 2px 8px rgba(255, 71, 87, 0.5);
        }

        .night-timer {
            color: var(--timer-red);
            text-shadow: 0 2px 8px rgba(255, 71, 87, 0.5);
        }

        /* تحسينات نظام الحفظ */
        .save-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            z-index: 999;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* تحسينات الأصوات - مؤقت للإصدار 2.0 */
        .sound-control {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
        }

        .sound-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* أنماط إضافية لتعديل وحذف الأسماء */
        .load-option {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .load-option:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
        }

        .load-option-content {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .load-option-controls {
            display: flex;
            gap: 5px;
        }

        .load-option-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .load-option-btn:hover {
            transform: scale(1.1);
        }

        .load-option-btn.edit {
            background: rgba(84, 160, 255, 0.2);
            color: var(--detective);
        }

        .load-option-btn.delete {
            background: rgba(255, 71, 87, 0.2);
            color: var(--accent);
        }

        /* أنماط خاصة بالإصدار 1.6 - تعديل أسماء الحفظ */
        .save-name-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 1rem;
            width: 100%;
            margin-top: 5px;
            display: none;
        }

        .save-name-input.active {
            display: block;
        }

        .save-name-display {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        .save-name-edit {
            color: var(--detective);
            cursor: pointer;
            margin-right: 5px;
        }

        .save-name-edit:hover {
            color: var(--accent);
        }

        .save-name-label {
            color: var(--accent);
            font-weight: bold;
        }

        .save-controls {
            display: flex;
            gap: 5px;
            margin-top: 8px;
            display: none;
        }

        .save-controls.active {
            display: flex;
        }

        .save-save-btn, .save-cancel-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .save-save-btn {
            background: var(--success);
            color: white;
        }

        .save-cancel-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        /* تحديث شارة الحفظ للإصدار 1.6 */
        .save-badge-1_6 {
            background: linear-gradient(135deg, rgba(155, 89, 182, 0.2), rgba(155, 89, 182, 0.1));
            color: var(--online);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-top: 5px;
            border: 1px solid rgba(155, 89, 182, 0.3);
            display: inline-block;
        }
    </style>
</head>
<body>
    <!-- تأثيرات النجوم -->
    <div class="stars" id="starsContainer"></div>

    <!-- حالة الحفظ -->
    <div class="save-status" id="saveStatus" style="display: none;">
        <i class="fas fa-save"></i> <span id="saveStatusText"></span>
    </div>

    <!-- صفحة البداية -->
    <div class="page active" id="startPage">
        <div class="page-content">
            <div class="start-screen">
                <h1 class="start-title">مافيا الأساطير</h1>
                <p class="start-subtitle">
                    انضم إلى المعركة الملحمية بين المافيا والمواطنين. استخدم ذكاءك ومهاراتك لاكتشاف الخونة وإنقاذ المدينة من براثن المافيا!
                </p>
                
                <div class="start-buttons">
                    <button class="start-btn start-btn-quick" id="quickStartBtn">
                        <i class="fas fa-bolt"></i>
                        بدء سريع
                        <div class="save-badge" id="saveBadge" style="display: none;">
                            <i class="fas fa-save"></i> محمل من حفظ سابق
                        </div>
                    </button>
                    <button class="start-btn start-btn-secondary" id="newGameBtn">
                        <i class="fas fa-plus-circle"></i>
                        لعبة جديدة
                    </button>
                    <button class="start-btn start-btn-online" id="onlineGameBtn">
                        <i class="fas fa-globe"></i>
                        لعب أونلاين (قريباً)
                    </button>
                    <button class="start-btn start-btn-special" id="tutorialBtn">
                        <i class="fas fa-graduation-cap"></i>
                        تعلم اللعب
                    </button>
                </div>
                
                <div class="start-features">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <h3 class="feature-title">لعب جماعي</h3>
                        <p class="feature-desc">ادع أصدقاءك للانضمام إلى اللعبة مع دعم حتى 15 لاعباً</p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-chess"></i>
                        </div>
                        <h3 class="feature-title">إستراتيجية عميقة</h3>
                        <p class="feature-desc">خطط واستخدم مهارات الشخصيات الفريدة للفوز بذكاء</p>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-trophy"></i>
                        </div>
                        <h3 class="feature-title">تحديات ممتعة</h3>
                        <p class="feature-desc">استمتع بتجربة لعب ديناميكية مع تحديات مختلفة كل مرة</p>
                    </div>
                </div>
            </div>
            
            <div class="page-footer">
                جميع الحقوق محفوظة لزياد العوني © 2026 - الإصدار 1.6
                <div class="info-links">
                    <a href="#" class="info-link" id="aboutLink">
                        <i class="fas fa-users"></i> من نحن
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- صفحة إعداد اللعبة -->
    <div class="page" id="setupPage">
        <div class="page-content">
            <div class="page-header">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-crown"></i>
                    </div>
                    <div class="logo-text">
                        <h1>مافيا الأساطير</h1>
                        <p>لعبة التحدي والذكاء الاستثنائية</p>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2 class="section-title">إعداد اللعبة</h2>
                <div class="player-input-container">
                    <div class="player-input">
                        <input type="text" id="playerName" placeholder="أدخل اسم اللاعب (12 حرف كحد أقصى)" maxlength="12">
                    </div>
                    <button class="btn btn-primary" id="addPlayer">
                        <i class="fas fa-plus"></i> إضافة لاعب
                    </button>
                </div>
                <div class="player-list" id="playerList"></div>
                <div class="game-controls">
                    <button class="btn btn-primary" id="startGame">
                        <i class="fas fa-play"></i> بدء اللعبة
                    </button>
                    <button class="btn btn-load" id="loadGame">
                        <i class="fas fa-folder-open"></i> تحميل الأسماء
                    </button>
                    <button class="btn btn-save" id="saveGame">
                        <i class="fas fa-save"></i> حفظ الأسماء
                    </button>
                </div>
            </div>
            
            <div class="navigation-buttons">
                <button class="nav-btn nav-btn-home" id="backToStartFromSetup">
                    <i class="fas fa-home"></i> العودة للرئيسية
                </button>
            </div>
            
            <div class="page-footer">
                جميع الحقوق محفوظة لزياد العوني © 2026 - الإصدار 1.6
                <div class="info-links">
                    <a href="#" class="info-link" id="aboutLinkFromSetup">
                        <i class="fas fa-users"></i> من نحن
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- صفحة التعليمات -->
    <div class="page" id="tutorialPage">
        <div class="page-content">
            <div class="page-header">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-crown"></i>
                    </div>
                    <div class="logo-text">
                        <h1>مافيا الأساطير</h1>
                        <p>لعبة التحدي والذكاء الاستثنائية</p>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2 class="section-title">كيفية اللعب والفوز</h2>
                <div class="characters-grid" id="tutorialCharactersGrid"></div>
                
                <div class="section" style="margin-top: 30px;">
                    <h3 class="section-title">دور الحكم</h3>
                    <div style="padding: 20px; background: rgba(255,255,255,0.05); border-radius: 12px;">
                        <h4 style="color: var(--judge); margin-bottom: 15px;">⚖️ الحكم (مسؤول اللعبة):</h4>
                        <div style="background: rgba(255, 215, 0, 0.1); padding: 15px; border-radius: 10px; margin-bottom: 15px; border-right: 3px solid var(--judge);">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                <div class="character-icon-large" style="--role-color: var(--judge);">
                                    <i class="fas fa-gavel" style="color: var(--judge);"></i>
                                </div>
                                <div>
                                    <h4 style="color: var(--judge); font-size: 1.3rem; margin-bottom: 5px;">دور الحكم</h4>
                                    <p style="color: var(--text-secondary);">المسؤول عن إدارة اللعبة وتنظيم المراحل</p>
                                </div>
                            </div>
                        </div>
                        
                        <h4 style="color: var(--accent); margin: 20px 0 15px;">📋 مسؤوليات الحكم:</h4>
                        <ul style="list-style-type: none; padding-right: 20px;">
                            <li style="margin-bottom: 10px; display: flex; align-items: flex-start;">
                                <i class="fas fa-check" style="color: var(--judge); margin-left: 10px; margin-top: 5px;"></i>
                                <span><strong>إدارة مراحل اللعبة:</strong> توجيه اللاعبين بين مراحل الليل والنهار</span>
                            </li>
                            <li style="margin-bottom: 10px; display: flex; align-items: flex-start;">
                                <i class="fas fa-check" style="color: var(--judge); margin-left: 10px; margin-top: 5px;"></i>
                                <span><strong>تنظيم الأدوار الليلية:</strong> إرشاد كل دور لأداء مهمته في الليل</span>
                            </li>
                            <li style="margin-bottom: 10px; display: flex; align-items: flex-start;">
                                <i class="fas fa-check" style="color: var(--judge); margin-left: 10px; margin-top: 5px;"></i>
                                <span><strong>تتبع الوقت:</strong> مراقبة المؤقت والتأكد من التزام اللاعبين بالوقت المحدد</span>
                            </li>
                            <li style="margin-bottom: 10px; display: flex; align-items: flex-start;">
                                <i class="fas fa-check" style="color: var(--judge); margin-left: 10px; margin-top: 5px;"></i>
                                <span><strong>تسجيل النتائج:</strong> تدوين نتائج التصويت وإجراءات الليل</span>
                            </li>
                            <li style="margin-bottom: 10px; display: flex; align-items: flex-start;">
                                <i class="fas fa-check" style="color: var(--judge); margin-left: 10px; margin-top: 5px;"></i>
                                <span><strong>حل النزاعات:</strong> الفصل في أي خلافات أو شكاوى بين اللاعبين</span>
                            </li>
                            <li style="margin-bottom: 10px; display: flex; align-items: flex-start;">
                                <i class="fas fa-check" style="color: var(--judge); margin-left: 10px; margin-top: 5px;"></i>
                                <span><strong>الإعلان عن النتائج:</strong> إعلان نتائج الليل والإعدامات</span>
                            </li>
                        </ul>
                        
                        <h4 style="color: var(--accent); margin: 20px 0 15px;">🔧 نصائح للحكم الناجح:</h4>
                        <ul style="list-style-type: none; padding-right: 20px;">
                            <li style="margin-bottom: 8px; display: flex; align-items: flex-start;">
                                <i class="fas fa-lightbulb" style="color: var(--warning); margin-left: 10px; margin-top: 3px;"></i>
                                <span>كن محايداً ولا تتحيز لأي فريق</span>
                            </li>
                            <li style="margin-bottom: 8px; display: flex; align-items: flex-start;">
                                <i class="fas fa-lightbulb" style="color: var(--warning); margin-left: 10px; margin-top: 3px;"></i>
                                <span>اشرح القواعد بوضوح قبل بدء اللعبة</span>
                            </li>
                            <li style="margin-bottom: 8px; display: flex; align-items: flex-start;">
                                <i class="fas fa-lightbulb" style="color: var(--warning); margin-left: 10px; margin-top: 3px;"></i>
                                <span>تحلى بالصبر مع اللاعبين الجدد</span>
                            </li>
                            <li style="margin-bottom: 8px; display: flex; align-items: flex-start;">
                                <i class="fas fa-lightbulb" style="color: var(--warning); margin-left: 10px; margin-top: 3px;"></i>
                                <span>حافظ على وتيرة سريعة للعبة</span>
                            </li>
                            <li style="margin-bottom: 8px; display: flex; align-items: flex-start;">
                                <i class="fas fa-lightbulb" style="color: var(--warning); margin-left: 10px; margin-top: 3px;"></i>
                                <span>تأكد من فهم الجميع للقواعد قبل البدء</span>
                            </li>
                        </ul>
                    </div>
                </div>
                
                <div class="section" style="margin-top: 30px;">
                    <h3 class="section-title">قواعد اللعبة</h3>
                    <div style="padding: 20px; background: rgba(255,255,255,0.05); border-radius: 12px;">
                        <h4 style="color: var(--accent); margin-bottom: 15px;">🎯 كيفية الفوز:</h4>
                        <ul style="list-style-type: none; padding-right: 20px;">
                            <li style="margin-bottom: 10px; display: flex; align-items: flex-start;">
                                <i class="fas fa-check" style="color: var(--success); margin-left: 10px; margin-top: 5px;"></i>
                                <span>فريق <strong style="color: var(--citizen);">المواطنين</strong> يفوز عندما يتم إعدام جميع أعضاء المافيا</span>
                            </li>
                            <li style="margin-bottom: 10px; display: flex; align-items: flex-start;">
                                <i class="fas fa-check" style="color: var(--success); margin-left: 10px; margin-top: 5px;"></i>
                                <span>فريق <strong style="color: var(--mafia);">المافيا</strong> يفوز عندما يصبح عددهم مساوياً أو أكثر من المواطنين</span>
                            </li>
                        </ul>
                        
                        <h4 style="color: var(--accent); margin: 20px 0 15px;">📋 توزيع الأدوار:</h4>
                        <ul style="list-style-type: none; padding-right: 20px;">
                            <li style="margin-bottom: 8px; display: flex; align-items: flex-start;">
                                <i class="fas fa-user-secret" style="color: var(--mafia); margin-left: 10px; margin-top: 3px;"></i>
                                <span><strong>زعيم المافيا:</strong> 1 فقط (من 8 لاعبين فما فوق)</span>
                            </li>
                            <li style="margin-bottom: 8px; display: flex; align-items: flex-start;">
                                <i class="fas fa-user-secret" style="color: var(--mafia); margin-left: 10px; margin-top: 3px;"></i>
                                <span><strong>عضو المافيا:</strong> 30% من اللاعبين (حد أقصى 2)</span>
                            </li>
                            <li style="margin-bottom: 8px; display: flex; align-items: flex-start;">
                                <i class="fas fa-heartbeat" style="color: var(--doctor); margin-left: 10px; margin-top: 3px;"></i>
                                <span><strong>الطبيب:</strong> 1 فقط (دائمًا)</span>
                            </li>
                            <li style="margin-bottom: 8px; display: flex; align-items: flex-start;">
                                <i class="fas fa-search" style="color: var(--detective); margin-left: 10px; margin-top: 3px;"></i>
                                <span><strong>المحقق:</strong> 1 فقط (دائمًا)</span>
                            </li>
                            <li style="margin-bottom: 8px; display: flex; align-items: flex-start;">
                                <i class="fas fa-crosshairs" style="color: var(--sniper); margin-left: 10px; margin-top: 3px;"></i>
                                <span><strong>القناص:</strong> 1 فقط (من 8 لاعبين فما فوق)</span>
                            </li>
                            <li style="margin-bottom: 8px; display: flex; align-items: flex-start;">
                                <i class="fas fa-user" style="color: var(--citizen); margin-left: 10px; margin-top: 3px;"></i>
                                <span><strong>المواطنون:</strong> الباقي (لا يملكون قدرات خاصة)</span>
                            </li>
                        </ul>
                        
                        <h4 style="color: var(--accent); margin: 20px 0 15px;">🔒 قيود القدرات:</h4>
                        <ul style="list-style-type: none; padding-right: 20px;">
                            <li style="margin-bottom: 8px; display: flex; align-items: flex-start;">
                                <i class="fas fa-ban" style="color: var(--danger); margin-left: 10px; margin-top: 3px;"></i>
                                <span>لا يمكن للمافيا قتل بعضهم البعض</span>
                            </li>
                            <li style="margin-bottom: 8px; display: flex; align-items: flex-start;">
                                <i class="fas fa-user-md" style="color: var(--doctor); margin-left: 10px; margin-top: 3px;"></i>
                                <span>الطبيب فقط يمكنه استخدام قدرته على نفسه</span>
                            </li>
                            <li style="margin-bottom: 8px; display: flex; align-items: flex-start;">
                                <i class="fas fa-ban" style="color: var(--danger); margin-left: 10px; margin-top: 3px;"></i>
                                <span>باقي الشخصيات لا يمكنهم استخدام قدراتهم على أنفسهم</span>
                            </li>
                            <li style="margin-bottom: 8px; display: flex; align-items: flex-start;">
                                <i class="fas fa-skull" style="color: var(--danger); margin-left: 10px; margin-top: 3px;"></i>
                                <span>لا يمكن للاعبين الموتى استخدام قدراتهم</span>
                            </li>
                            <li style="margin-bottom: 8px; display: flex; align-items: flex-start;">
                                <i class="fas fa-crosshairs" style="color: var(--sniper); margin-left: 10px; margin-top: 3px;"></i>
                                <span>القناص لا يمكنه القنص إلا إذا كان موجوداً (حي)</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="navigation-buttons">
                <button class="nav-btn nav-btn-home" id="backToStartFromTutorial">
                    <i class="fas fa-home"></i> العودة للرئيسية
                </button>
            </div>
            
            <div class="page-footer">
                جميع الحقوق محفوظة لزياد العوني © 2026 - الإصدار 1.6
                <div class="info-links">
                    <a href="#" class="info-link" id="aboutLinkFromTutorial">
                        <i class="fas fa-users"></i> من نحن
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- صفحة من نحن -->
    <div class="page" id="aboutPage">
        <div class="page-content">
            <div class="page-header">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-crown"></i>
                    </div>
                    <div class="logo-text">
                        <h1>مافيا الأساطير</h1>
                        <p>لعبة التحدي والذكاء الاستثنائية</p>
                    </div>
                </div>
            </div>
            
            <div class="about-container">
                <div class="about-icon">
                    <i class="fas fa-info-circle"></i>
                </div>
                <h1 class="about-title">من نحن - الإصدار 1.6</h1>
                
                <div class="about-content">
                    <div class="about-section">
                        <h2 class="about-section-title">🚀 تحديث الإصدار 1.6 - نظام الحفظ المتطور</h2>
                        <p>
                            نحن فخورون بتقديم الإصدار 1.6 من "مافيا الأساطير" مع تحسينات كبيرة في نظام الحفظ والتحميل!
                        </p>
                    </div>
                    
                    <div class="about-section">
                        <h2 class="about-section-title">✨ الميزات الجديدة في الإصدار 1.6</h2>
                        
                        <div class="about-features">
                            <div class="about-feature">
                                <div class="about-feature-icon">
                                    <i class="fas fa-edit"></i>
                                </div>
                                <div class="about-feature-title">تعديل أسماء الحفظ</div>
                                <div class="about-feature-desc">
                                    إمكانية تعديل اسم الحفظ بدلاً من تعديل أسماء اللاعبين، مما يجعل النظام أكثر مرونة وسهولة
                                </div>
                            </div>
                            
                            <div class="about-feature">
                                <div class="about-feature-icon">
                                    <i class="fas fa-tag"></i>
                                </div>
                                <div class="about-feature-title">تسمية الحفظ الشخصية</div>
                                <div class="about-feature-desc">
                                    إمكانية إعطاء أسماء خاصة لكل حفظ مثل "أصدقاء الجامعة" أو "الأسرة" للتمييز بين المجموعات
                                </div>
                            </div>
                            
                            <div class="about-feature">
                                <div class="about-feature-icon">
                                    <i class="fas fa-sync-alt"></i>
                                </div>
                                <div class="about-feature-title">نظام استرجاع متقدم</div>
                                <div class="about-feature-desc">
                                    حفظ تلقائي مع استرجاع للنسخ الاحتياطية السابقة عند فقدان البيانات
                                </div>
                            </div>
                            
                            <div class="about-feature">
                                <div class="about-feature-icon">
                                    <i class="fas fa-shield-alt"></i>
                                </div>
                                <div class="about-feature-title">حماية البيانات</div>
                                <div class="about-feature-desc">
                                    نظام حماية متطور لمنع فقدان البيانات مع نسخ احتياطية تلقائية
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="about-section">
                        <h2 class="about-section-title">👨‍💻 فريق التطوير</h2>
                        
                        <div class="team-member">
                            <div class="team-member-avatar">
                                <i class="fas fa-code"></i>
                            </div>
                            <div class="team-member-info">
                                <div class="team-member-name">زياد العوني</div>
                                <div class="team-member-role">مطور ومصمم اللعبة الرئيسي</div>
                                <div class="team-member-desc">
                                    مطور ويب متخصص في تصميم وتطوير الألعاب التفاعلية والعربية. 
                                    يمتلك خبرة واسعة في تطوير تطبيقات الويب باستخدام التقنيات الحديثة.
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="about-section">
                        <h2 class="about-section-title">🚀 مستقبل اللعبة - الإصدار 2.0 قريباً!</h2>
                        <div style="background: rgba(255, 107, 107, 0.1); padding: 20px; border-radius: 12px; margin: 20px 0; border: 2px solid var(--accent);">
                            <h3 style="color: var(--accent); margin-bottom: 15px;">🔥 ميزات الإصدار 2.0 القادم:</h3>
                            <ul style="list-style-type: none; padding-right: 20px;">
                                <li style="margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                                    <i class="fas fa-globe" style="color: var(--online);"></i>
                                    <span><strong>اللعب الأونلاين:</strong> تحديات مع لاعبين من حول العالم</span>
                                </li>
                                <li style="margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                                    <i class="fas fa-volume-up" style="color: var(--detective);"></i>
                                    <span><strong>نظام الأصوات الكامل:</strong> مؤثرات صوتية وموسيقى تبعث على التشويق</span>
                                </li>
                                <li style="margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                                    <i class="fas fa-user-plus" style="color: var(--success);"></i>
                                    <span><strong>شخصيات جديدة:</strong> أدوار وحدة لعب مبتكرة</span>
                                </li>
                                <li style="margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                                    <i class="fas fa-chart-line" style="color: var(--warning);"></i>
                                    <span><strong>تحسينات كبيرة:</strong> في الأداء والتجربة والأمان</span>
                                </li>
                            </ul>
                            <p style="color: var(--text-secondary); margin-top: 15px; text-align: center; font-style: italic;">
                                🎮 الإصدار 2.0 قيد التطوير حاليًا وسيتم إطلاقه قريباً!
                            </p>
                        </div>
                    </div>
                    
                    <div class="about-section">
                        <h2 class="about-section-title">🤝 شكر وتقدير</h2>
                        <p>
                            نشكر كل لاعب ساهم في نجاح اللعبة، سواء بمشاركته، 
                            باقتراحاته، أو بنقده البناء الذي ساعدنا على التحسين والتطوير.
                        </p>
                        <p>
                            "مافيا الأساطير" هي لعبتكم، ونحن هنا لجعلها الأفضل دائماً.
                        </p>
                    </div>
                </div>
            </div>
            
            <div class="navigation-buttons">
                <button class="nav-btn nav-btn-home" id="backToStartFromAbout">
                    <i class="fas fa-home"></i> العودة للرئيسية
                </button>
            </div>
            
            <div class="page-footer">
                جميع الحقوق محفوظة لزياد العوني © 2026 - الإصدار 1.6
            </div>
        </div>
    </div>

    <!-- صفحات اللعبة الأساسية -->
    <!-- صفحة تسليم الجهاز - محدثة -->
    <div class="page" id="handoverPage">
        <div class="page-content">
            <div class="page-header">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-crown"></i>
                    </div>
                    <div class="logo-text">
                        <h1>مافيا الأساطير</h1>
                        <p>لعبة التحدي والذكاء الاستثنائية</p>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <div class="role-section">
                    <!-- اسم اللاعب فقط بدون أيقونة -->
                    <h2 class="role-title">سلم الجهاز للاعب</h2>
                    
                    <div class="player-name-large" id="handoverPlayer">
                        اسم اللاعب
                    </div>
                    
                    <button class="btn btn-primary" id="confirmHandover">
                        <i class="fas fa-check"></i> تأكيد الاستلام
                    </button>
                </div>
            </div>
            
            <div class="navigation-buttons">
                <button class="nav-btn nav-btn-home" id="backToStartFromHandover">
                    <i class="fas fa-home"></i> العودة للرئيسية
                </button>
            </div>
            
            <div class="page-footer">
                جميع الحقوق محفوظة لزياد العوني © 2026 - الإصدار 1.6
                <div class="info-links">
                    <a href="#" class="info-link" id="aboutLinkFromHandover">
                        <i class="fas fa-users"></i> من نحن
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- صفحة عرض الدور - محدثة -->
    <div class="page" id="rolePage">
        <div class="page-content">
            <div class="page-header">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-crown"></i>
                    </div>
                    <div class="logo-text">
                        <h1>مافيا الأساطير</h1>
                        <p>لعبة التحدي والذكاء الاستثنائية</p>
                    </div>
                </div>
            </div>
            
            <div class="role-display-container">
                <!-- أيقونة الدور الكبيرة في الوسط -->
                <div class="role-display-icon-large" id="roleDisplayIconLarge">
                    <i class="fas fa-user" id="roleDisplayIconInner"></i>
                </div>
                
                <h2 class="role-display-title" id="roleDisplayTitle">دورك في اللعبة</h2>
                
                <!-- اسم اللاعب مع تصميم دائري -->
                <div class="role-player-circle" id="rolePlayerCircle">
                    <div class="player-circle-name" id="roleDisplayPlayer">اسم اللاعب</div>
                    <div class="player-circle-role" id="roleDisplayRoleName">المواطن</div>
                </div>
                
                <!-- معلومات الدور مع تصميم جديد -->
                <div class="role-info-card">
                    <div class="role-info-icon">
                        <i class="fas fa-info-circle"></i>
                    </div>
                    <p class="role-display-description" id="roleDisplayDescription">
                        وصف الدور سوف يظهر هنا مع تفاصيل المهمة والمسؤوليات
                    </p>
                </div>
                
                <button class="btn btn-primary" id="nextPlayerRole">
                    <i class="fas fa-arrow-left"></i> اللاعب التالي
                </button>
            </div>
            
            <div class="navigation-buttons">
                <button class="nav-btn nav-btn-home" id="backToStartFromRole">
                    <i class="fas fa-home"></i> العودة للرئيسية
                </button>
            </div>
            
            <div class="page-footer">
                جميع الحقوق محفوظة لزياد العوني © 2026 - الإصدار 1.6
                <div class="info-links">
                    <a href="#" class="info-link" id="aboutLinkFromRole">
                        <i class="fas fa-users"></i> من نحن
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- صفحة تسليم الحكم - محدثة -->
    <div class="page" id="judgeHandoverPage">
        <div class="page-content">
            <div class="page-header">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-crown"></i>
                    </div>
                    <div class="logo-text">
                        <h1>مافيا الأساطير</h1>
                        <p>لعبة التحدي والذكاء الاستثنائية</p>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <div class="judge-handover-section">
                    <!-- أيقونة الحكم الكبيرة في الوسط -->
                    <div class="judge-icon-large">
                        <i class="fas fa-gavel"></i>
                    </div>
                    
                    <h2 class="judge-title">سلم الجهاز للحكم</h2>
                    
                    <!-- تصميم خاص لدور الحكم -->
                    <div class="judge-info-card">
                        <div class="judge-info-header">
                            <i class="fas fa-star"></i>
                            <h3>المسؤوليات الرئيسية</h3>
                        </div>
                        <ul class="judge-responsibilities">
                            <li><i class="fas fa-moon"></i> إدارة مرحلة الليل</li>
                            <li><i class="fas fa-sun"></i> تنظيم مرحلة النهار</li>
                            <li><i class="fas fa-clock"></i> متابعة المؤقتات</li>
                            <li><i class="fas fa-balance-scale"></i> حل النزاعات</li>
                        </ul>
                    </div>
                    
                    <p class="judge-description">
                        سيقوم الحكم بإدارة مرحلة الليل وتوجيه اللاعبين لأدوارهم
                    </p>
                    
                    <button class="btn btn-primary" id="confirmJudgeHandover">
                        <i class="fas fa-check"></i> تأكيد الاستلام
                    </button>
                </div>
            </div>
            
            <div class="navigation-buttons">
                <button class="nav-btn nav-btn-home" id="backToStartFromJudgeHandover">
                    <i class="fas fa-home"></i> العودة للرئيسية
                </button>
            </div>
            
            <div class="page-footer">
                جميع الحقوق محفوظة لزياد العوني © 2026 - الإصدار 1.6
                <div class="info-links">
                    <a href="#" class="info-link" id="aboutLinkFromJudgeHandover">
                        <i class="fas fa-users"></i> من نحن
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- صفحة الليل -->
    <div class="page" id="nightPage">
        <div class="page-content">
            <div class="page-header">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-crown"></i>
                    </div>
                    <div class="logo-text">
                        <h1>مافيا الأساطير</h1>
                        <p>لعبة التحدي والذكاء الاستثنائية</p>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <div class="game-header">
                    <div class="phase-indicator phase-night" id="phaseIndicator">الليل</div>
                    <div class="timer night-timer" id="gameTimer">40</div>
                    
                    <!-- تحكمات المؤقت -->
                    <div class="timer-controls">
                        <button class="timer-btn" id="pauseTimer" title="إيقاف">
                            <i class="fas fa-pause"></i>
                        </button>
                        <button class="timer-btn" id="resumeTimer" title="استئناف" style="display: none;">
                            <i class="fas fa-play"></i>
                        </button>
                        <button class="timer-btn" id="resetTimer" title="إعادة تعيين">
                            <i class="fas fa-redo"></i>
                        </button>
                    </div>
                    
                    <h3 class="phase-description" id="phaseDescription">دور المافيا: اختيار هدف للقتل</h3>
                    
                    <!-- عرض اسم اللاعب حامل الدور الحالي -->
                    <div class="current-role-player" id="currentRolePlayer"></div>
                    
                    <div class="phase-progress" id="phaseProgress">
                        <div class="phase-step">
                            <div class="phase-circle active">1</div>
                            <div class="phase-label">المافيا</div>
                        </div>
                        <div class="phase-step">
                            <div class="phase-circle">2</div>
                            <div class="phase-label">المحقق</div>
                        </div>
                        <div class="phase-step">
                            <div class="phase-circle">3</div>
                            <div class="phase-label">الطبيب</div>
                        </div>
                        <div class="phase-step">
                            <div class="phase-circle">4</div>
                            <div class="phase-label">القناص</div>
                        </div>
                    </div>
                </div>
                
                <div class="players-grid" id="nightPlayersGrid"></div>
                <div class="game-controls">
                    <button class="btn btn-primary" id="submitNightAction">
                        <i class="fas fa-check"></i> تأكيد الاختيار
                    </button>
                    <button class="btn btn-skip" id="skipNightAction">
                        <i class="fas fa-forward"></i> تخطي
                    </button>
                </div>
            </div>
            
            <div class="navigation-buttons">
                <button class="nav-btn nav-btn-home" id="backToStartFromNight">
                    <i class="fas fa-home"></i> العودة للرئيسية
                </button>
            </div>
            
            <div class="page-footer">
                جميع الحقوق محفوظة لزياد العوني © 2026 - الإصدار 1.6
                <div class="info-links">
                    <a href="#" class="info-link" id="aboutLinkFromNight">
                        <i class="fas fa-users"></i> من نحن
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- صفحة النتائج -->
    <div class="page" id="resultsPage">
        <div class="page-content">
            <div class="page-header">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-crown"></i>
                    </div>
                    <div class="logo-text">
                        <h1>مافيا الأساطير</h1>
                        <p>لعبة التحدي والذكاء الاستثنائية</p>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2 class="section-title">نتائج الليلة الماضية</h2>
                <div class="results-container" id="resultsContainer">
                    <div class="day-title" id="dayTitle">نتائج اليوم 1</div>
                </div>
                <div class="game-controls">
                    <button class="btn btn-primary" id="continueToDiscussion">
                        <i class="fas fa-comments"></i> بدء المناقشة
                    </button>
                </div>
            </div>
            
            <div class="navigation-buttons">
                <button class="nav-btn nav-btn-home" id="backToStartFromResults">
                    <i class="fas fa-home"></i> العودة للرئيسية
                </button>
            </div>
            
            <div class="page-footer">
                جميع الحقوق محفوظة لزياد العوني © 2026 - الإصدار 1.6
                <div class="info-links">
                    <a href="#" class="info-link" id="aboutLinkFromResults">
                        <i class="fas fa-users"></i> من نحن
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- صفحة النهار -->
    <div class="page" id="dayPage">
        <div class="page-content">
            <div class="page-header">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-crown"></i>
                    </div>
                    <div class="logo-text">
                        <h1>مافيا الأساطير</h1>
                        <p>لعبة التحدي والذكاء الاستثنائية</p>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <div class="game-header">
                    <div class="phase-indicator phase-day" id="dayPhaseIndicator">النهار</div>
                    <div class="timer day-timer" id="dayTimer">120</div>
                    
                    <!-- تحكمات المؤقت -->
                    <div class="timer-controls">
                        <button class="timer-btn" id="pauseDayTimer" title="إيقاف">
                            <i class="fas fa-pause"></i>
                        </button>
                        <button class="timer-btn" id="resumeDayTimer" title="استئناف" style="display: none;">
                            <i class="fas fa-play"></i>
                        </button>
                        <button class="timer-btn" id="resetDayTimer" title="إعادة تعيين">
                            <i class="fas fa-redo"></i>
                        </button>
                    </div>
                    
                    <h3 class="phase-description" id="dayPhaseDescription">مرحلة النهار: مناقشة واختيار لاعب للإعدام</h3>
                </div>
                
                <div class="players-grid" id="dayPlayersGrid"></div>
                <div class="game-controls">
                    <button class="btn btn-primary" id="submitDayAction">
                        <i class="fas fa-check"></i> تأكيد الاختيار
                    </button>
                    <button class="btn btn-skip" id="skipDayAction">
                        <i class="fas fa-forward"></i> تخطي
                    </button>
                </div>
            </div>
            
            <div class="navigation-buttons">
                <button class="nav-btn nav-btn-home" id="backToStartFromDay">
                    <i class="fas fa-home"></i> العودة للرئيسية
                </button>
            </div>
            
            <div class="page-footer">
                جميع الحقوق محفوظة لزياد العوني © 2026 - الإصدار 1.6
                <div class="info-links">
                    <a href="#" class="info-link" id="aboutLinkFromDay">
                        <i class="fas fa-users"></i> من نحن
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- صفحة نتائج التصويت -->
    <div class="page" id="votingResultsPage">
        <div class="page-content">
            <div class="page-header">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-crown"></i>
                    </div>
                    <div class="logo-text">
                        <h1>مافيا الأساطير</h1>
                        <p>لعبة التحدي والذكاء الاستثنائية</p>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2 class="section-title">نتائج التصويت</h2>
                
                <div class="voting-results" id="votingResults">
                    <!-- سيتم تعبئتها ديناميكياً -->
                </div>
                
                <div class="game-controls">
                    <button class="btn btn-primary" id="continueAfterVoting">
                        <i class="fas fa-arrow-left"></i> الاستمرار في اللعبة
                    </button>
                </div>
            </div>
            
            <div class="navigation-buttons">
                <button class="nav-btn nav-btn-home" id="backToStartFromVotingResults">
                    <i class="fas fa-home"></i> العودة للرئيسية
                </button>
            </div>
            
            <div class="page-footer">
                جميع الحقوق محفوظة لزياد العوني © 2026 - الإصدار 1.6
                <div class="info-links">
                    <a href="#" class="info-link" id="aboutLinkFromVotingResults">
                        <i class="fas fa-users"></i> من نحن
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- صفحة الفوز -->
    <div class="page" id="victoryPage">
        <div class="page-content">
            <div class="page-header">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-crown"></i>
                    </div>
                    <div class="logo-text">
                        <h1>مافيا الأساطير</h1>
                        <p>لعبة التحدي والذكاء الاستثنائية</p>
                    </div>
                </div>
            </div>
            
            <div class="victory-screen" id="victoryScreen">
                <!-- محتوى الفوز سيتم تعبئته ديناميكياً -->
            </div>
            
            <div class="navigation-buttons">
                <button class="nav-btn nav-btn-repeat" id="playAgainBtn">
                    <i class="fas fa-redo"></i> لعب مجدداً
                </button>
                <button class="nav-btn nav-btn-home" id="backToStartFromVictory">
                    <i class="fas fa-home"></i> العودة للرئيسية
                </button>
            </div>
            
            <div class="page-footer">
                جميع الحقوق محفوظة لزياد العوني © 2026 - الإصدار 1.6
                <div class="info-links">
                    <a href="#" class="info-link" id="aboutLinkFromVictory">
                        <i class="fas fa-users"></i> من نحن
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- النوافذ المنبثقة -->
    <div class="modal" id="infoModal">
        <div class="modal-content">
            <div class="modal-title">مافيا الأساطير - الإصدار 1.6</div>
            <div class="modal-message">
                <strong>لعبة الذكاء والتحدي المحسنة</strong><br><br>
                إصدار 1.6 يأتي مع تحسينات كبيرة في:<br>
                ✓ نظام الحفظ المتطور<br>
                ✓ تعديل أسماء الحفظ<br>
                ✓ إدارة محسنة للحفظ<br>
                ✓ تجربة لعب أفضل
            </div>
            <button class="btn btn-primary" id="closeInfo">إغلاق</button>
        </div>
    </div>

    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <div class="modal-title">تأكيد العودة</div>
            <div class="modal-message">
                <i class="fas fa-exclamation-triangle" style="color: var(--warning); font-size: 2.5rem; margin-bottom: 15px;"></i>
                <p>هل أنت متأكد أنك تريد العودة إلى الشاشة الرئيسية؟</p>
                <p style="color: var(--accent); margin-top: 12px;">⚠️ سيتم فقدان تقدم اللعبة الحالية</p>
            </div>
            <div style="display: flex; gap: 12px; justify-content: center; margin-top: 20px;">
                <button class="btn btn-primary" id="confirmHome">
                    <i class="fas fa-check"></i> نعم، العودة
                </button>
                <button class="btn btn-back" id="cancelHome">
                    <i class="fas fa-times"></i> إلغاء
                </button>
            </div>
        </div>
    </div>

    <!-- نافذة تأكيد الحفظ -->
    <div class="modal" id="saveConfirmModal">
        <div class="modal-content">
            <div class="modal-title">تم الحفظ بنجاح</div>
            <div class="modal-message">
                <i class="fas fa-check-circle" style="color: var(--success); font-size: 3rem; margin-bottom: 15px;"></i>
                <p>تم حفظ الأسماء بنجاح!</p>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 10px;">
                    يمكنك تحميل الأسماء في أي وقت من خلال زر "تحميل الأسماء"
                </p>
            </div>
            <button class="btn btn-primary" id="closeSaveConfirm">موافق</button>
        </div>
    </div>

    <!-- نافذة تحميل الأسماء - محدثة للإصدار 1.6 -->
    <div class="modal" id="loadGameModal">
        <div class="modal-content">
            <div class="modal-title">تحميل الأسماء</div>
            <div class="modal-message">
                <p>اختر قائمة الأسماء التي تريد تحميلها:</p>
                <div id="loadGameOptions" style="margin: 15px 0; max-height: 300px; overflow-y: auto;">
                    <!-- سيتم تعبئتها ديناميكياً -->
                </div>
            </div>
            <div style="display: flex; gap: 12px; justify-content: center; margin-top: 20px;">
                <button class="btn btn-primary" id="confirmLoad">
                    <i class="fas fa-check"></i> تحميل
                </button>
                <button class="btn btn-back" id="cancelLoad">
                    <i class="fas fa-times"></i> إلغاء
                </button>
            </div>
        </div>
    </div>

    <!-- نافذة تأكيد الحذف -->
    <div class="modal" id="deleteConfirmModal">
        <div class="modal-content">
            <div class="modal-title">تأكيد الحذف</div>
            <div class="modal-message">
                <i class="fas fa-exclamation-triangle" style="color: var(--danger); font-size: 2.5rem; margin-bottom: 15px;"></i>
                <p>هل أنت متأكد أنك تريد حذف هذه القائمة؟</p>
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 10px;">
                    <span id="deleteListName"></span>
                </p>
                <p style="color: var(--accent); margin-top: 12px;">⚠️ هذا الإجراء لا يمكن التراجع عنه</p>
            </div>
            <div style="display: flex; gap: 12px; justify-content: center; margin-top: 20px;">
                <button class="btn btn-primary" id="confirmDelete">
                    <i class="fas fa-trash"></i> نعم، حذف
                </button>
                <button class="btn btn-back" id="cancelDelete">
                    <i class="fas fa-times"></i> إلغاء
                </button>
            </div>
        </div>
    </div>

    <!-- نافذة تعديل اسم الحفظ - جديدة للإصدار 1.6 -->
    <div class="modal" id="editSaveNameModal">
        <div class="modal-content">
            <div class="modal-title">تعديل اسم الحفظ</div>
            <div class="modal-message">
                <p>أدخل اسم جديد للحفظ:</p>
                <input type="text" id="newSaveNameInput" placeholder="مثال: أصدقاء الجامعة" maxlength="20" style="width: 100%; padding: 10px; margin: 10px 0; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; border-radius: 8px; font-size: 1rem;">
                <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 10px;">
                    سيتم تغيير اسم الحفظ فقط، وليس أسماء اللاعبين
                </p>
            </div>
            <div style="display: flex; gap: 12px; justify-content: center; margin-top: 20px;">
                <button class="btn btn-primary" id="confirmEditSaveName">
                    <i class="fas fa-check"></i> حفظ التعديل
                </button>
                <button class="btn btn-back" id="cancelEditSaveName">
                    <i class="fas fa-times"></i> إلغاء
                </button>
            </div>
        </div>
    </div>

    <script>
        // بيانات الشخصيات
        const characters = [
            {
                id: 'godfather',
                name: 'زعيم المافيا',
                icon: 'fa-crown',
                color: 'godfather',
                description: 'القائد الأقوى للمافيا، يظهر كمواطن عند التحقيق ويقود فريقه نحو النصر.',
                details: ['يظهر كمواطن عند التحقيق من قبل المحقق', 'يقود عملية القتل الليلي مع فريق المافيا', 'الأكثر خطورة في اللعبة', 'يعمل مع أعضاء المافيا الآخرين']
            },
            {
                id: 'doctor',
                name: 'الطبيب',
                icon: 'fa-user-md',
                color: 'doctor',
                description: 'طبيب البلدة الماهر، يمكنه إنقاذ لاعب واحد كل ليلة من قتل المافيا.',
                details: ['ينقذ لاعباً واحداً كل ليلة من القتل', 'يمكنه إنقاذ نفسه', 'يحاول حماية الأدوار المهمة', 'مهم لحماية المواطنين']
            },
            {
                id: 'mafia',
                name: 'عضو المافيا',
                icon: 'fa-user-secret',
                color: 'mafia',
                description: 'عضو في منظمة المافيا السرية، يعمل مع زملائه للتخلص من المواطنين ليلاً.',
                details: ['يقتل لاعباً واحداً كل ليلة', 'يتعاون مع أعضاء المافيا الآخرين', 'يحاول إخفاء هويته عن المواطنين', 'يعمل تحت قيادة زعيم المافيا']
            },
            {
                id: 'detective',
                name: 'المحقق',
                icon: 'fa-search',
                color: 'detective',
                description: 'محقق الشرطة السري، يمكنه التحقق من هوية لاعب واحد كل ليلة لاكتشاف المافيا.',
                details: ['يتحقق من هوية لاعب واحد كل ليلة', 'يظهر له إذا كان اللاعب من المافيا أم لا', 'زعيم المافيا يظهر كمواطن عند التحقيق', 'يساعد المواطنين في اكتشاف المافيا']
            },
            {
                id: 'sniper',
                name: 'القناص',
                icon: 'fa-crosshairs',
                color: 'sniper',
                description: 'قناص محترف يملك رصاصة واحدة فقط، يمكنه استخدامها خلال الليل لقتل مشتبه به.',
                details: ['يملك رصاصة واحدة فقط في اللعبة', 'يستخدمها خلال مرحلة الليل', 'إذا لم يقتل المافيا يموت في الليل', 'يمكنه قتل لاعب يشتبه أنه من المافيا']
            },
            {
                id: 'citizen',
                name: 'المواطن',
                icon: 'fa-user',
                color: 'citizen',
                description: 'مواطن عادي لا يملك قدرات خاصة، يعتمد على الذكاء والملاحظة لاكتشاف المافيا.',
                details: ['لا يملك قدرات خاصة', 'يعتمد على التحليل والمناقشة', 'يصوت لاكتشاف وإعدام المافيا', 'يحاول البقاء على قيد الحياة']
            },
            {
                id: 'judge',
                name: 'الحكم',
                icon: 'fa-gavel',
                color: 'judge',
                description: 'الحكم المسؤول عن إدارة اللعبة وتنظيم المراحل، دوره حيوي لسير اللعبة بسلاسة.',
                details: ['يدير مراحل اللعبة (ليل/نهار)', 'يتابع المؤقت والوقت المحدد', 'يسجل النتائج والإجراءات', 'يحل النزاعات بين اللاعبين', 'يعلن النتائج الرسمية']
            }
        ];

        // حالة اللعبة الكاملة للإصدار 1.6
        let gameState = {
            players: [],
            currentPage: 'start',
            rolesAssigned: false,
            currentPlayerIndex: 0,
            gamePhase: 'night',
            currentRoleAction: 'mafia',
            timer: 40,
            timerInterval: null,
            selectedPlayer: null,
            votes: {},
            killedTonight: null,
            savedTonight: null,
            investigatedTonight: null,
            sniperTarget: null,
            sniperBullet: true,
            dayResults: [],
            votedPlayers: new Set(),
            totalVotes: 0,
            dayNumber: 1,
            currentActionPlayer: null,
            votingPhase: false,
            playerVotes: {},
            voteHistory: [],
            currentPlayerRole: null,
            votingResults: [],
            executedPlayer: null,
            sniperUsedBullet: false,
            gameWinner: null,
            skipVotes: 0,
            previousPlayers: [],
            timerPaused: false,
            saveVersion: '1.6',
            gameStarted: false,
            editingSaveNameKey: null,
            deletingListKey: null,
            savingListName: ''
        };

        // عناصر DOM الكاملة
        const elements = {
            startPage: document.getElementById('startPage'),
            setupPage: document.getElementById('setupPage'),
            tutorialPage: document.getElementById('tutorialPage'),
            aboutPage: document.getElementById('aboutPage'),
            handoverPage: document.getElementById('handoverPage'),
            rolePage: document.getElementById('rolePage'),
            judgeHandoverPage: document.getElementById('judgeHandoverPage'),
            nightPage: document.getElementById('nightPage'),
            resultsPage: document.getElementById('resultsPage'),
            dayPage: document.getElementById('dayPage'),
            votingResultsPage: document.getElementById('votingResultsPage'),
            victoryPage: document.getElementById('victoryPage'),
            
            // أزرار التنقل
            backToStartFromSetup: document.getElementById('backToStartFromSetup'),
            backToStartFromTutorial: document.getElementById('backToStartFromTutorial'),
            backToStartFromAbout: document.getElementById('backToStartFromAbout'),
            backToStartFromHandover: document.getElementById('backToStartFromHandover'),
            backToStartFromRole: document.getElementById('backToStartFromRole'),
            backToStartFromJudgeHandover: document.getElementById('backToStartFromJudgeHandover'),
            backToStartFromNight: document.getElementById('backToStartFromNight'),
            backToStartFromResults: document.getElementById('backToStartFromResults'),
            backToStartFromDay: document.getElementById('backToStartFromDay'),
            backToStartFromVotingResults: document.getElementById('backToStartFromVotingResults'),
            backToStartFromVictory: document.getElementById('backToStartFromVictory'),
            
            // أزرار الصفحة الرئيسية
            quickStartBtn: document.getElementById('quickStartBtn'),
            newGameBtn: document.getElementById('newGameBtn'),
            onlineGameBtn: document.getElementById('onlineGameBtn'),
            tutorialBtn: document.getElementById('tutorialBtn'),
            saveBadge: document.getElementById('saveBadge'),
            
            // روابط المعلومات
            aboutLink: document.getElementById('aboutLink'),
            aboutLinkFromSetup: document.getElementById('aboutLinkFromSetup'),
            aboutLinkFromTutorial: document.getElementById('aboutLinkFromTutorial'),
            aboutLinkFromHandover: document.getElementById('aboutLinkFromHandover'),
            aboutLinkFromRole: document.getElementById('aboutLinkFromRole'),
            aboutLinkFromJudgeHandover: document.getElementById('aboutLinkFromJudgeHandover'),
            aboutLinkFromNight: document.getElementById('aboutLinkFromNight'),
            aboutLinkFromResults: document.getElementById('aboutLinkFromResults'),
            aboutLinkFromDay: document.getElementById('aboutLinkFromDay'),
            aboutLinkFromVotingResults: document.getElementById('aboutLinkFromVotingResults'),
            aboutLinkFromVictory: document.getElementById('aboutLinkFromVictory'),
            
            // أزرار اللعبة
            playAgainBtn: document.getElementById('playAgainBtn'),
            
            // إعداد اللعبة
            playerNameInput: document.getElementById('playerName'),
            addPlayerBtn: document.getElementById('addPlayer'),
            playerList: document.getElementById('playerList'),
            startGameBtn: document.getElementById('startGame'),
            tutorialCharactersGrid: document.getElementById('tutorialCharactersGrid'),
            loadGameBtn: document.getElementById('loadGame'),
            saveGameBtn: document.getElementById('saveGame'),
            
            // تسليم الأدوار
            confirmHandoverBtn: document.getElementById('confirmHandover'),
            confirmJudgeHandoverBtn: document.getElementById('confirmJudgeHandover'),
            nextPlayerRoleBtn: document.getElementById('nextPlayerRole'),
            
            // مرحلة الليل
            submitNightAction: document.getElementById('submitNightAction'),
            skipNightAction: document.getElementById('skipNightAction'),
            
            // مرحلة النهار
            submitDayAction: document.getElementById('submitDayAction'),
            skipDayAction: document.getElementById('skipDayAction'),
            
            // الاستمرار
            continueToDiscussion: document.getElementById('continueToDiscussion'),
            continueAfterVoting: document.getElementById('continueAfterVoting'),
            
            // المؤقتات والمؤشرات
            phaseIndicator: document.getElementById('phaseIndicator'),
            gameTimer: document.getElementById('gameTimer'),
            phaseDescription: document.getElementById('phaseDescription'),
            dayPhaseIndicator: document.getElementById('dayPhaseIndicator'),
            dayTimer: document.getElementById('dayTimer'),
            dayPhaseDescription: document.getElementById('dayPhaseDescription'),
            nightPlayersGrid: document.getElementById('nightPlayersGrid'),
            dayPlayersGrid: document.getElementById('dayPlayersGrid'),
            
            // عرض الدور
            roleDisplayIconLarge: document.getElementById('roleDisplayIconLarge'),
            roleDisplayIconInner: document.getElementById('roleDisplayIconInner'),
            roleDisplayTitle: document.getElementById('roleDisplayTitle'),
            roleDisplayPlayer: document.getElementById('roleDisplayPlayer'),
            roleDisplayRoleName: document.getElementById('roleDisplayRoleName'),
            roleDisplayDescription: document.getElementById('roleDisplayDescription'),
            rolePlayerCircle: document.getElementById('rolePlayerCircle'),
            
            // تسليم الأدوار
            handoverPlayer: document.getElementById('handoverPlayer'),
            
            // النتائج
            resultsContainer: document.getElementById('resultsContainer'),
            votingResults: document.getElementById('votingResults'),
            dayTitle: document.getElementById('dayTitle'),
            
            // النوافذ المنبثقة
            confirmModal: document.getElementById('confirmModal'),
            confirmHome: document.getElementById('confirmHome'),
            cancelHome: document.getElementById('cancelHome'),
            closeInfo: document.getElementById('closeInfo'),
            saveConfirmModal: document.getElementById('saveConfirmModal'),
            closeSaveConfirm: document.getElementById('closeSaveConfirm'),
            loadGameModal: document.getElementById('loadGameModal'),
            loadGameOptions: document.getElementById('loadGameOptions'),
            confirmLoad: document.getElementById('confirmLoad'),
            cancelLoad: document.getElementById('cancelLoad'),
            deleteConfirmModal: document.getElementById('deleteConfirmModal'),
            confirmDelete: document.getElementById('confirmDelete'),
            cancelDelete: document.getElementById('cancelDelete'),
            deleteListName: document.getElementById('deleteListName'),
            editSaveNameModal: document.getElementById('editSaveNameModal'),
            newSaveNameInput: document.getElementById('newSaveNameInput'),
            confirmEditSaveName: document.getElementById('confirmEditSaveName'),
            cancelEditSaveName: document.getElementById('cancelEditSaveName'),
            
            // التقدم
            phaseProgress: document.getElementById('phaseProgress'),
            victoryScreen: document.getElementById('victoryScreen'),
            currentRolePlayer: document.getElementById('currentRolePlayer'),
            
            // التحكمات الجديدة
            pauseTimer: document.getElementById('pauseTimer'),
            resumeTimer: document.getElementById('resumeTimer'),
            resetTimer: document.getElementById('resetTimer'),
            pauseDayTimer: document.getElementById('pauseDayTimer'),
            resumeDayTimer: document.getElementById('resumeDayTimer'),
            resetDayTimer: document.getElementById('resetDayTimer'),
            saveStatus: document.getElementById('saveStatus'),
            saveStatusText: document.getElementById('saveStatusText')
        };

        // تهيئة اللعبة
        function initGame() {
            createStars();
            setupEventListeners();
            displayTutorialCharacters();
            checkSavedNames();
        }

        // التحقق من وجود أسماء محفوظة
        function checkSavedNames() {
            try {
                const savedData = localStorage.getItem('mafiaSavedNamesData');
                
                if (savedData) {
                    try {
                        const data = JSON.parse(savedData);
                        
                        if (data && data.names && data.names.length >= 4) {
                            elements.saveBadge.style.display = 'block';
                            elements.saveBadge.innerHTML = `<i class="fas fa-save"></i> ${data.names.length} أسماء محفوظة`;
                            
                            if (data.saveName) {
                                elements.saveBadge.innerHTML += ` - ${data.saveName}`;
                            }
                            
                            // تحديث حالة الحفظ
                            updateSaveStatus(`${data.names.length} أسماء جاهزة للتحميل`);
                            return true;
                        }
                    } catch (e) {
                        console.log('Error parsing saved names data:', e);
                    }
                }
                
                elements.saveBadge.style.display = 'none';
                return false;
                
            } catch (error) {
                console.error('Error checking saved names:', error);
                return false;
            }
        }

        // إعداد مستمعي الأحداث
        function setupEventListeners() {
            // أزرار الصفحة الرئيسية
            elements.quickStartBtn.addEventListener('click', quickStart);
            elements.newGameBtn.addEventListener('click', showSetupPage);
            elements.tutorialBtn.addEventListener('click', showTutorialPage);
            elements.onlineGameBtn.addEventListener('click', () => {
                showMessage('ميزة اللعب أونلاين قريباً في الإصدار 2.0!', 'warning');
            });
            
            // روابط المعلومات
            elements.aboutLink.addEventListener('click', () => showPage('about'));
            elements.aboutLinkFromSetup.addEventListener('click', () => showPage('about'));
            elements.aboutLinkFromTutorial.addEventListener('click', () => showPage('about'));
            elements.aboutLinkFromHandover.addEventListener('click', () => showPage('about'));
            elements.aboutLinkFromRole.addEventListener('click', () => showPage('about'));
            elements.aboutLinkFromJudgeHandover.addEventListener('click', () => showPage('about'));
            elements.aboutLinkFromNight.addEventListener('click', () => showPage('about'));
            elements.aboutLinkFromResults.addEventListener('click', () => showPage('about'));
            elements.aboutLinkFromDay.addEventListener('click', () => showPage('about'));
            elements.aboutLinkFromVotingResults.addEventListener('click', () => showPage('about'));
            elements.aboutLinkFromVictory.addEventListener('click', () => showPage('about'));
            
            // أزرار التنقل
            elements.backToStartFromSetup.addEventListener('click', showStartPage);
            elements.backToStartFromTutorial.addEventListener('click', showStartPage);
            elements.backToStartFromAbout.addEventListener('click', showStartPage);
            elements.backToStartFromHandover.addEventListener('click', () => {
                if (gameState.gameStarted) {
                    document.getElementById('confirmModal').style.display = 'flex';
                } else {
                    showStartPage();
                }
            });
            elements.backToStartFromRole.addEventListener('click', () => {
                if (gameState.gameStarted) {
                    document.getElementById('confirmModal').style.display = 'flex';
                } else {
                    showStartPage();
                }
            });
            elements.backToStartFromJudgeHandover.addEventListener('click', () => {
                if (gameState.gameStarted) {
                    document.getElementById('confirmModal').style.display = 'flex';
                } else {
                    showStartPage();
                }
            });
            elements.backToStartFromNight.addEventListener('click', () => {
                if (gameState.gameStarted) {
                    document.getElementById('confirmModal').style.display = 'flex';
                } else {
                    showStartPage();
                }
            });
            elements.backToStartFromResults.addEventListener('click', () => {
                if (gameState.gameStarted) {
                    document.getElementById('confirmModal').style.display = 'flex';
                } else {
                    showStartPage();
                }
            });
            elements.backToStartFromDay.addEventListener('click', () => {
                if (gameState.gameStarted) {
                    document.getElementById('confirmModal').style.display = 'flex';
                } else {
                    showStartPage();
                }
            });
            elements.backToStartFromVotingResults.addEventListener('click', () => {
                if (gameState.gameStarted) {
                    document.getElementById('confirmModal').style.display = 'flex';
                } else {
                    showStartPage();
                }
            });
            elements.backToStartFromVictory.addEventListener('click', showStartPage);
            
            // أزرار الإعداد
            elements.addPlayerBtn.addEventListener('click', addPlayer);
            elements.playerNameInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addPlayer();
            });
            elements.startGameBtn.addEventListener('click', startGame);
            elements.loadGameBtn.addEventListener('click', showLoadNamesModal);
            elements.saveGameBtn.addEventListener('click', showSaveNamePrompt);
            
            // أزرار تسليم الأدوار
            elements.confirmHandoverBtn.addEventListener('click', showPlayerRole);
            elements.nextPlayerRoleBtn.addEventListener('click', showNextPlayerRole);
            elements.confirmJudgeHandoverBtn.addEventListener('click', startNightPhase);
            
            // أزرار مرحلة الليل
            elements.submitNightAction.addEventListener('click', submitNightAction);
            elements.skipNightAction.addEventListener('click', skipNightAction);
            
            // أزرار مرحلة النهار
            elements.submitDayAction.addEventListener('click', submitDayAction);
            elements.skipDayAction.addEventListener('click', skipDayAction);
            
            // أزرار الاستمرار
            elements.continueToDiscussion.addEventListener('click', continueToDiscussion);
            elements.continueAfterVoting.addEventListener('click', continueAfterVoting);
            
            // أزرار الفوز
            elements.playAgainBtn.addEventListener('click', playAgain);
            
            // أزرار التحكم بالمؤقت
            if (elements.pauseTimer) {
                elements.pauseTimer.addEventListener('click', pauseTimer);
                elements.resumeTimer.addEventListener('click', resumeTimer);
                elements.resetTimer.addEventListener('click', resetTimer);
            }
            
            if (elements.pauseDayTimer) {
                elements.pauseDayTimer.addEventListener('click', pauseDayTimer);
                elements.resumeDayTimer.addEventListener('click', resumeDayTimer);
                elements.resetDayTimer.addEventListener('click', resetDayTimer);
            }
            
            // النوافذ المنبثقة
            elements.closeInfo.addEventListener('click', () => {
                document.getElementById('infoModal').style.display = 'none';
            });
            
            elements.confirmHome.addEventListener('click', () => {
                document.getElementById('confirmModal').style.display = 'none';
                gameState.gameStarted = false;
                showStartPage();
            });
            
            elements.cancelHome.addEventListener('click', () => {
                document.getElementById('confirmModal').style.display = 'none';
            });
            
            elements.closeSaveConfirm.addEventListener('click', () => {
                document.getElementById('saveConfirmModal').style.display = 'none';
            });
            
            elements.confirmLoad.addEventListener('click', confirmLoadNames);
            elements.cancelLoad.addEventListener('click', () => {
                document.getElementById('loadGameModal').style.display = 'none';
            });
            
            // أحداث الحذف
            elements.confirmDelete.addEventListener('click', confirmDeleteList);
            elements.cancelDelete.addEventListener('click', () => {
                document.getElementById('deleteConfirmModal').style.display = 'none';
                gameState.deletingListKey = null;
            });
            
            // أحداث تعديل اسم الحفظ
            elements.confirmEditSaveName.addEventListener('click', confirmEditSaveName);
            elements.cancelEditSaveName.addEventListener('click', () => {
                document.getElementById('editSaveNameModal').style.display = 'none';
                gameState.editingSaveNameKey = null;
            });
        }

        // دالة اللعب مجدداً
        function playAgain() {
            if (gameState.previousPlayers.length > 0) {
                gameState.players = gameState.previousPlayers.map(player => ({
                    name: player.name,
                    role: null,
                    alive: true,
                    votes: 0
                }));
                
                assignRoles();
                showHandoverPage();
                showMessage('تم بدء لعبة جديدة بنفس اللاعبين!', 'success');
            } else {
                showSetupPage();
            }
        }

        // دوال عرض الصفحات
        function showPage(pageId) {
            hideAllPages();
            document.getElementById(pageId + 'Page').classList.add('active');
            gameState.currentPage = pageId;
            
            if (pageId === 'setup') {
                updatePlayerList();
            } else if (pageId === 'night') {
                updateNightPhase();
                startTimer();
            } else if (pageId === 'day') {
                updateDayPhase();
                startDayTimer();
            } else if (pageId === 'results') {
                updateResultsPage();
            } else if (pageId === 'votingResults') {
                updateVotingResults();
            }
        }

        function showStartPage() {
            document.getElementById('confirmModal').style.display = 'none';
            showPage('start');
        }

        function showSetupPage() {
            gameState.gameStarted = false;
            showPage('setup');
        }

        function showTutorialPage() {
            showPage('tutorial');
        }

        function showAboutPage() {
            showPage('about');
        }

        function showHandoverPage() {
            showPage('handover');
            if (gameState.currentPlayerIndex < gameState.players.length) {
                const player = gameState.players[gameState.currentPlayerIndex];
                elements.handoverPlayer.textContent = player.name;
            }
        }

        function showRolePage() {
            showPage('role');
        }

        function showJudgeHandoverPage() {
            showPage('judgeHandover');
        }

        function showNightPage() {
            showPage('night');
        }

        function showResultsPage() {
            showPage('results');
        }

        function showDayPage() {
            showPage('day');
        }

        function showVotingResultsPage() {
            showPage('votingResults');
        }

        function showVictoryPage() {
            showPage('victory');
        }

        function hideAllPages() {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
        }

        // دالة البدء السريع الجديدة
        function quickStart() {
            try {
                // محاولة تحميل الأسماء المحفوظة
                const savedData = localStorage.getItem('mafiaSavedNamesData');
                
                if (savedData) {
                    const data = JSON.parse(savedData);
                    
                    if (data && data.names && data.names.length >= 4) {
                        gameState.players = data.names.map(name => ({
                            name: name,
                            role: null,
                            alive: true,
                            votes: 0
                        }));
                        
                        assignRoles();
                        gameState.gameStarted = true;
                        showHandoverPage();
                        
                        let message = 'تم تحميل الأسماء المحفوظة وبدء اللعبة!';
                        if (data.saveName) {
                            message += ` (${data.saveName})`;
                        }
                        
                        showMessage(message, 'success');
                        return;
                    }
                }
                
                // بدء لعبة جديدة
                startNewQuickGame();
                
            } catch (error) {
                console.error('Error loading saved names:', error);
                showMessage('حدث خطأ في تحميل الأسماء المحفوظة', 'error');
                startNewQuickGame();
            }
        }

        // دالة بدء لعبة سريعة جديدة
        function startNewQuickGame() {
            const defaultNames = ['أحمد', 'محمد', 'فاطمة', 'علي', 'سارة', 'يوسف', 'مريم', 'خالد'];
            
            gameState.players = defaultNames.map(name => ({
                name: name,
                role: null,
                alive: true,
                votes: 0
            }));
            
            gameState.previousPlayers = JSON.parse(JSON.stringify(gameState.players));
            
            assignRoles();
            gameState.gameStarted = true;
            showHandoverPage();
            showMessage('تم بدء لعبة سريعة جديدة!', 'success');
        }

        // دالة إضافة لاعب
        function addPlayer() {
            const playerName = elements.playerNameInput.value.trim();
            
            if (playerName && playerName.length <= 12) {
                if (gameState.players.length < 15) {
                    gameState.players.push({
                        name: playerName,
                        role: null,
                        alive: true,
                        votes: 0
                    });
                    
                    elements.playerNameInput.value = '';
                    updatePlayerList();
                    showMessage(`تم إضافة اللاعب ${playerName}`, 'success');
                } else {
                    showMessage('لا يمكن إضافة أكثر من 15 لاعب', 'error');
                }
            } else if (playerName.length > 12) {
                showMessage('اسم اللاعب يجب أن يكون 12 حرفاً كحد أقصى', 'error');
            } else {
                showMessage('يرجى إدخال اسم اللاعب', 'error');
            }
        }

        // دالة تحديث قائمة اللاعبين
        function updatePlayerList() {
            elements.playerList.innerHTML = '';
            
            gameState.players.forEach((player, index) => {
                const playerTag = document.createElement('div');
                playerTag.classList.add('player-tag');
                playerTag.innerHTML = `
                    <span>${player.name}</span>
                    <button onclick="removePlayer(${index})">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                playerTag.querySelector('button').addEventListener('click', (e) => {
                    e.stopPropagation();
                    removePlayer(index);
                });
                
                elements.playerList.appendChild(playerTag);
            });
            
            // تغيير الشرط من 6 إلى 4 لاعبين
            elements.startGameBtn.disabled = gameState.players.length < 4;
        }

        // دالة إزالة لاعب
        function removePlayer(index) {
            const playerName = gameState.players[index].name;
            gameState.players.splice(index, 1);
            updatePlayerList();
            showMessage(`تم إزالة اللاعب ${playerName}`, 'success');
        }

        // دالة بدء اللعبة
        function startGame() {
            if (gameState.players.length >= 4) { // تغيير من 6 إلى 4
                gameState.previousPlayers = JSON.parse(JSON.stringify(gameState.players));
                assignRoles();
                gameState.gameStarted = true;
                showHandoverPage();
                showMessage('تم بدء اللعبة بنجاح!', 'success');
            } else {
                showMessage('يجب إضافة 4 لاعبين على الأقل', 'error'); // تغيير من 6 إلى 4
            }
        }

        // دالة توزيع الأدوار وفقاً للنسب المطلوبة
        function assignRoles() {
            const playerCount = gameState.players.length;
            
            // حساب الأدوار وفقاً للنسب المطلوبة
            let roles = [];
            
            // زعيم المافيا: من 8 لاعبين فما فوق (ثابت 1)
            if (playerCount >= 8) {
                roles.push('godfather');
            }
            
            // عضو المافيا: 30% (حد أقصى 2)
            let mafiaCount = Math.floor(playerCount * 0.3);
            mafiaCount = Math.min(mafiaCount, 2); // حد أقصى 2
            for (let i = 0; i < mafiaCount; i++) {
                roles.push('mafia');
            }
            
            // محقق: ثابت 1 (دائمًا)
            roles.push('detective');
            
            // طبيب: ثابت 1 (دائمًا)
            roles.push('doctor');
            
            // قناص: من 8 لاعبين فما فوق (ثابت 1)
            if (playerCount >= 8) {
                roles.push('sniper');
            }
            
            // المواطنون: يأخذون الباقي
            const remainingCount = playerCount - roles.length;
            for (let i = 0; i < remainingCount; i++) {
                roles.push('citizen');
            }
            
            // خلط الأدوار عشوائيًا
            for (let i = roles.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [roles[i], roles[j]] = [roles[j], roles[i]];
            }
            
            // توزيع الأدوار على اللاعبين
            gameState.players.forEach((player, index) => {
                player.role = roles[index];
            });
            
            gameState.rolesAssigned = true;
            gameState.currentPlayerIndex = 0;
            
            // تسجيل توزيع الأدوار للتحقق
            console.log('تم توزيع الأدوار كما يلي:');
            console.log(`- إجمالي اللاعبين: ${playerCount}`);
            console.log(`- زعيم المافيا: ${playerCount >= 8 ? 1 : 0}`);
            console.log(`- أعضاء المافيا: ${mafiaCount} (30%)`);
            console.log(`- محقق: 1`);
            console.log(`- طبيب: 1`);
            console.log(`- قناص: ${playerCount >= 8 ? 1 : 0}`);
            console.log(`- مواطنون: ${remainingCount}`);
            
            showMessage('تم توزيع الأدوار بنجاح', 'success');
        }

        // دالة عرض دور اللاعب
        function showPlayerRole() {
            if (gameState.currentPlayerIndex < gameState.players.length) {
                const player = gameState.players[gameState.currentPlayerIndex];
                const character = characters.find(c => c.id === player.role);
                
                elements.roleDisplayPlayer.textContent = player.name;
                elements.roleDisplayRoleName.textContent = character.name;
                elements.roleDisplayTitle.textContent = character.name;
                elements.roleDisplayIconInner.className = `fas ${character.icon}`;
                elements.roleDisplayIconLarge.className = `role-display-icon-large ${player.role}`;
                elements.roleDisplayDescription.textContent = character.description;
                
                showRolePage();
            }
        }

        // دالة عرض دور اللاعب التالي
        function showNextPlayerRole() {
            gameState.currentPlayerIndex++;
            
            if (gameState.currentPlayerIndex < gameState.players.length) {
                showHandoverPage();
            } else {
                showJudgeHandoverPage();
            }
        }

        // دالة بدء مرحلة الليل
        function startNightPhase() {
            gameState.gamePhase = 'night';
            gameState.currentRoleAction = 'mafia';
            gameState.timer = 40;
            
            showNightPage();
            startTimer();
            updateNightPhase();
        }

        // دالة تحديث مرحلة الليل
        function updateNightPhase() {
            let description = '';
            
            switch (gameState.currentRoleAction) {
                case 'mafia':
                    description = 'دور المافيا: اختيار هدف للقتل';
                    break;
                case 'detective':
                    description = 'دور المحقق: التحقق من هوية لاعب';
                    break;
                case 'doctor':
                    description = 'دور الطبيب: اختيار لاعب لإنقاذه';
                    break;
                case 'sniper':
                    description = 'دور القناص: اختيار هدف لإطلاق النار عليه';
                    break;
            }
            
            elements.phaseDescription.textContent = description;
            updateCurrentRolePlayer();
            updatePlayersGrid(elements.nightPlayersGrid, true);
            updatePhaseProgress();
        }

        // دالة تحديث اسم اللاعب حامل الدور الحالي
        function updateCurrentRolePlayer() {
            const currentRole = gameState.currentRoleAction;
            
            if (currentRole === 'mafia') {
                const mafiaPlayers = gameState.players.filter(p => 
                    (p.role === 'mafia' || p.role === 'godfather') && p.alive
                );
                
                if (mafiaPlayers.length > 0) {
                    const mafiaNames = mafiaPlayers.map(p => p.name).join('، ');
                    elements.currentRolePlayer.textContent = `${mafiaNames} - فريق المافيا`;
                } else {
                    skipNightAction();
                    return;
                }
            } else {
                const rolePlayer = gameState.players.find(p => p.role === currentRole && p.alive);
                
                if (rolePlayer) {
                    const character = characters.find(c => c.id === currentRole);
                    elements.currentRolePlayer.textContent = `${rolePlayer.name} - ${character.name}`;
                } else {
                    skipNightAction();
                    return;
                }
            }
        }

        // دالة تحديث تقدم المراحل
        function updatePhaseProgress() {
            const phases = ['mafia', 'detective', 'doctor', 'sniper'];
            const currentPhaseIndex = phases.indexOf(gameState.currentRoleAction);
            
            document.querySelectorAll('.phase-step').forEach((step, index) => {
                const circle = step.querySelector('.phase-circle');
                if (index <= currentPhaseIndex) {
                    circle.classList.add('active');
                } else {
                    circle.classList.remove('active');
                }
            });
        }

        // دالة تحديث شبكة اللاعبين
        function updatePlayersGrid(gridElement, isNight) {
            gridElement.innerHTML = '';
            
            gameState.players.forEach((player) => {
                if (player.alive) {
                    const playerCard = document.createElement('div');
                    playerCard.classList.add('player-card');
                    
                    if (gameState.selectedPlayer === player) {
                        playerCard.classList.add('selected');
                    }
                    
                    if (!player.alive) {
                        playerCard.classList.add('dead');
                    }
                    
                    if (isNight) {
                        const currentRole = gameState.currentRoleAction;
                        const isCurrentPlayer = (currentRole === 'doctor' && player.role === 'doctor') ||
                                               (currentRole === 'detective' && player.role === 'detective') ||
                                               (currentRole === 'sniper' && player.role === 'sniper') ||
                                               ((currentRole === 'mafia') && (player.role === 'mafia' || player.role === 'godfather'));
                        
                        if (isCurrentPlayer && currentRole !== 'doctor') {
                            playerCard.classList.add('disabled');
                        }
                    }
                    
                    playerCard.innerHTML = `
                        <div>${player.name}</div>
                    `;
                    
                    playerCard.addEventListener('click', () => {
                        if (isNight) {
                            selectPlayerForNightAction(player);
                        } else {
                            selectPlayerForVoting(player);
                        }
                    });
                    
                    gridElement.appendChild(playerCard);
                }
            });
        }

        // دالة اختيار لاعب لإجراء الليل
        function selectPlayerForNightAction(player) {
            if (gameState.currentRoleAction === 'mafia' && 
                (player.role === 'mafia' || player.role === 'godfather')) {
                showMessage('لا يمكن للمافيا قتل بعضهم البعض', 'error');
                return;
            }
            
            if ((gameState.currentRoleAction === 'detective' && player.role === 'detective') ||
                (gameState.currentRoleAction === 'sniper' && player.role === 'sniper')) {
                showMessage('لا يمكنك استخدام قدرتك على نفسك', 'error');
                return;
            }
            
            gameState.selectedPlayer = player;
            updatePlayersGrid(elements.nightPlayersGrid, true);
        }

        // دالة تأكيد إجراء الليل
        function submitNightAction() {
            if (gameState.selectedPlayer) {
                switch (gameState.currentRoleAction) {
                    case 'mafia':
                        gameState.killedTonight = gameState.selectedPlayer;
                        break;
                    case 'detective':
                        gameState.investigatedTonight = gameState.selectedPlayer;
                        break;
                    case 'doctor':
                        gameState.savedTonight = gameState.selectedPlayer;
                        break;
                    case 'sniper':
                        const sniperPlayer = gameState.players.find(p => p.role === 'sniper' && p.alive);
                        if (!sniperPlayer) {
                            showMessage('القناص ميت ولا يمكنه استخدام قدرته', 'error');
                            return;
                        }
                        gameState.sniperTarget = gameState.selectedPlayer;
                        gameState.sniperUsedBullet = true;
                        break;
                }
                
                showMessage(`تم اختيار اللاعب ${gameState.selectedPlayer.name}`, 'success');
                
                if (gameState.currentRoleAction === 'detective' && gameState.investigatedTonight) {
                    const isMafia = gameState.investigatedTonight.role === 'mafia' || 
                                   gameState.investigatedTonight.role === 'godfather';
                    
                    const result = gameState.investigatedTonight.role === 'godfather' ? 'مواطن' : 
                                  (isMafia ? 'مافيا' : 'مواطن');
                    
                    showMessage(`اللاعب ${gameState.investigatedTonight.name} هو ${result}`, 'warning');
                }
                
                const phases = ['mafia', 'detective', 'doctor', 'sniper'];
                const currentIndex = phases.indexOf(gameState.currentRoleAction);
                
                if (currentIndex < phases.length - 1) {
                    gameState.currentRoleAction = phases[currentIndex + 1];
                    gameState.selectedPlayer = null;
                    gameState.timer = 40;
                    updateNightPhase();
                } else {
                    resolveNightActions();
                }
            } else {
                showMessage('يرجى اختيار لاعب', 'error');
            }
        }

        // دالة تخطي إجراء الليل
        function skipNightAction() {
            const phases = ['mafia', 'detective', 'doctor', 'sniper'];
            const currentIndex = phases.indexOf(gameState.currentRoleAction);
            
            if (currentIndex < phases.length - 1) {
                gameState.currentRoleAction = phases[currentIndex + 1];
                gameState.selectedPlayer = null;
                gameState.timer = 40;
                updateNightPhase();
            } else {
                resolveNightActions();
            }
        }

        // دالة معالجة إجراءات الليل
        function resolveNightActions() {
            if (gameState.killedTonight && gameState.killedTonight !== gameState.savedTonight) {
                gameState.killedTonight.alive = false;
                gameState.dayResults.push({
                    type: 'kill',
                    player: gameState.killedTonight.name,
                    saved: false
                });
            } else if (gameState.killedTonight) {
                gameState.dayResults.push({
                    type: 'kill',
                    player: gameState.killedTonight.name,
                    saved: true
                });
            }
            
            if (gameState.sniperUsedBullet && gameState.sniperTarget) {
                const sniperPlayer = gameState.players.find(p => p.role === 'sniper' && p.alive);
                if (sniperPlayer) {
                    if (gameState.sniperTarget.role !== 'mafia' && gameState.sniperTarget.role !== 'godfather') {
                        sniperPlayer.alive = false;
                        gameState.dayResults.push({
                            type: 'sniperDeath',
                            player: sniperPlayer.name
                        });
                    } else {
                        gameState.sniperTarget.alive = false;
                        gameState.dayResults.push({
                            type: 'sniperKill',
                            player: gameState.sniperTarget.name
                        });
                    }
                    gameState.sniperBullet = false;
                }
            }
            
            if (checkGameWinner()) {
                showVictoryScreen();
                return;
            }
            
            showResultsPage();
        }

        // دالة تحديث صفحة النتائج
        function updateResultsPage() {
            elements.dayTitle.textContent = `نتائج اليوم ${gameState.dayNumber}`;
            elements.resultsContainer.innerHTML = '';
            
            if (gameState.dayResults.length === 0) {
                elements.resultsContainer.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">لم تحدث أي أحداث في الليلة الماضية</p>';
            } else {
                gameState.dayResults.forEach(result => {
                    const resultItem = document.createElement('div');
                    resultItem.classList.add('result-item');
                    
                    let icon, text;
                    
                    switch (result.type) {
                        case 'kill':
                            if (result.saved) {
                                icon = 'fa-heart';
                                text = `تم إنقاذ ${result.player} من قبل الطبيب`;
                            } else {
                                icon = 'fa-skull';
                                text = `تم قتل ${result.player} من قبل المافيا`;
                            }
                            break;
                        case 'sniperKill':
                            icon = 'fa-crosshairs';
                            text = `تم قتل ${result.player} من قبل القناص`;
                            break;
                        case 'sniperDeath':
                            icon = 'fa-user-slash';
                            text = `مات القناص ${result.player} لأنه أخطأ في الهدف`;
                            break;
                        case 'execute':
                            icon = 'fa-gavel';
                            text = `تم إعدام ${result.player} بالتصويت`;
                            break;
                    }
                    
                    resultItem.innerHTML = `
                        <i class="fas ${icon}" style="color: var(--accent); font-size: 1.5rem;"></i>
                        <span>${text}</span>
                    `;
                    
                    elements.resultsContainer.appendChild(resultItem);
                });
            }
        }

        // دالة الاستمرار إلى المناقشة
        function continueToDiscussion() {
            showDayPage();
            startDayTimer();
        }

        // دالة تحديث مرحلة النهار
        function updateDayPhase() {
            elements.dayPhaseDescription.textContent = 'مرحلة النهار: مناقشة واختيار لاعب للإعدام';
            updatePlayersGrid(elements.dayPlayersGrid, false);
        }

        // دالة اختيار لاعب للتصويت
        function selectPlayerForVoting(player) {
            gameState.selectedPlayer = player;
            updatePlayersGrid(elements.dayPlayersGrid, false);
        }

        // دالة تأكيد التصويت
        function submitDayAction() {
            if (gameState.selectedPlayer) {
                if (!gameState.votes[gameState.selectedPlayer.name]) {
                    gameState.votes[gameState.selectedPlayer.name] = 0;
                }
                gameState.votes[gameState.selectedPlayer.name]++;
                gameState.totalVotes++;
                
                showMessage(`تم اختيار اللاعب ${gameState.selectedPlayer.name}`, 'success');
                
                if (gameState.totalVotes >= gameState.players.filter(p => p.alive).length) {
                    processVotingResults();
                } else {
                    gameState.selectedPlayer = null;
                    updatePlayersGrid(elements.dayPlayersGrid, false);
                }
            } else {
                showMessage('يرجى اختيار لاعب للتصويت', 'error');
            }
        }

        // دالة تخطي التصويت
        function skipDayAction() {
            gameState.skipVotes++;
            gameState.totalVotes++;
            
            showMessage('تم تخطي التصويت', 'warning');
            
            if (gameState.totalVotes >= gameState.players.filter(p => p.alive).length) {
                processVotingResults();
            } else {
                gameState.selectedPlayer = null;
                updatePlayersGrid(elements.dayPlayersGrid, false);
            }
        }

        // دالة معالجة نتائج التصويت
        function processVotingResults() {
            let maxVotes = 0;
            let executedPlayer = null;
            
            for (const [playerName, votes] of Object.entries(gameState.votes)) {
                if (votes > maxVotes) {
                    maxVotes = votes;
                    executedPlayer = gameState.players.find(p => p.name === playerName);
                }
            }
            
            if (gameState.skipVotes >= maxVotes) {
                executedPlayer = null;
            } else {
                let tieCount = 0;
                for (const [playerName, votes] of Object.entries(gameState.votes)) {
                    if (votes === maxVotes) {
                        tieCount++;
                    }
                }
                
                if (tieCount > 1) {
                    executedPlayer = null;
                }
            }
            
            gameState.executedPlayer = executedPlayer;
            showVotingResultsPage();
        }

        // دالة تحديث نتائج التصويت
        function updateVotingResults() {
            elements.votingResults.innerHTML = '';
            
            if (gameState.executedPlayer) {
                const character = characters.find(c => c.id === gameState.executedPlayer.role);
                
                elements.votingResults.innerHTML = `
                    <div class="vote-result-item">
                        <div class="vote-result-icon">
                            <i class="fas fa-skull"></i>
                        </div>
                        <div class="vote-result-details">
                            <div class="vote-result-name">${gameState.executedPlayer.name}</div>
                            <div class="vote-result-count">عدد الأصوات: ${gameState.votes[gameState.executedPlayer.name]}</div>
                            <div class="vote-result-executed">تم إعدامه - ${character.name}</div>
                        </div>
                    </div>
                `;
            } else {
                elements.votingResults.innerHTML = `
                    <div class="vote-result-item">
                        <div class="vote-result-icon">
                            <i class="fas fa-balance-scale"></i>
                        </div>
                        <div class="vote-result-details">
                            <div class="vote-result-name">تعادل في الأصوات</div>
                            <div class="vote-result-count">عدد أصوات التخطي: ${gameState.skipVotes}</div>
                            <div class="vote-result-saved">لم يتم إعدام أي لاعب</div>
                        </div>
                    </div>
                `;
            }
        }

        // دالة الاستمرار بعد التصويت
        function continueAfterVoting() {
            if (gameState.executedPlayer) {
                gameState.executedPlayer.alive = false;
                gameState.dayResults.push({
                    type: 'execute',
                    player: gameState.executedPlayer.name
                });
                
                if (checkGameWinner()) {
                    showVictoryScreen();
                    return;
                }
            }
            
            gameState.dayNumber++;
            gameState.gamePhase = 'night';
            gameState.currentRoleAction = 'mafia';
            gameState.killedTonight = null;
            gameState.savedTonight = null;
            gameState.investigatedTonight = null;
            gameState.sniperTarget = null;
            gameState.dayResults = [];
            gameState.timer = 40;
            gameState.sniperUsedBullet = false;
            gameState.votes = {};
            gameState.totalVotes = 0;
            gameState.skipVotes = 0;
            gameState.executedPlayer = null;
            
            showJudgeHandoverPage();
        }

        // دالة التحقق من الفوز
        function checkGameWinner() {
            const alivePlayers = gameState.players.filter(p => p.alive);
            const mafiaPlayers = alivePlayers.filter(p => p.role === 'mafia' || p.role === 'godfather');
            const citizenPlayers = alivePlayers.filter(p => p.role !== 'mafia' && p.role !== 'godfather');
            
            if (mafiaPlayers.length === 0) {
                gameState.gameWinner = 'citizen';
                return true;
            }
            
            if (mafiaPlayers.length >= citizenPlayers.length) {
                gameState.gameWinner = 'mafia';
                return true;
            }
            
            return false;
        }

        // دالة عرض شاشة الفوز
        function showVictoryScreen() {
            createConfetti();
            showVictoryPage();
            
            const winner = gameState.gameWinner;
            const alivePlayers = gameState.players.filter(p => p.alive);
            const mafiaPlayers = gameState.players.filter(p => (p.role === 'mafia' || p.role === 'godfather') && p.alive);
            const citizenPlayers = gameState.players.filter(p => (p.role !== 'mafia' && p.role !== 'godfather') && p.alive);
            const deadPlayers = gameState.players.filter(p => !p.alive);
            
            let victoryHTML = '';
            
            if (winner === 'citizen') {
                victoryHTML = `
                    <div class="victory-icon">
                        <i class="fas fa-shield-alt" style="color: var(--citizen);"></i>
                    </div>
                    <h1 class="victory-title victory-citizen">فوز المواطنين! 🎉</h1>
                    <p class="victory-subtitle">
                        تمكن المواطنون من اكتشاف وإعدام جميع أعضاء المافيا!<br>
                        تم استعادة السلام والأمان إلى البلدة.
                    </p>
                `;
            } else {
                victoryHTML = `
                    <div class="victory-icon">
                        <i class="fas fa-skull" style="color: var(--mafia);"></i>
                    </div>
                    <h1 class="victory-title victory-mafia">فوز المافيا! 💀</h1>
                    <p class="victory-subtitle">
                        سيطرت المافيا على البلدة وتخلصت من جميع المواطنين!<br>
                        أصبحت البلدة تحت سيطرة الظلام.
                    </p>
                `;
            }
            
            victoryHTML += `
                <div class="victory-stats">
                    <div class="victory-stat">
                        <div class="victory-stat-number victory-stat-citizen">${citizenPlayers.length}</div>
                        <div class="victory-stat-label">مواطنون أحياء</div>
                    </div>
                    <div class="victory-stat">
                        <div class="victory-stat-number victory-stat-mafia">${mafiaPlayers.length}</div>
                        <div class="victory-stat-label">مافيا أحياء</div>
                    </div>
                    <div class="victory-stat">
                        <div class="victory-stat-number">${deadPlayers.length}</div>
                        <div class="victory-stat-label">لاعبون موتى</div>
                    </div>
                    <div class="victory-stat">
                        <div class="victory-stat-number">${gameState.dayNumber}</div>
                        <div class="victory-stat-label">أيام اللعب</div>
                    </div>
                </div>
            `;
            
            victoryHTML += `
                <div class="victory-players">
                    <div class="victory-players-title">اللاعبون:</div>
            `;
            
            gameState.players.forEach(player => {
                const character = characters.find(c => c.id === player.role);
                const statusClass = player.alive ? 'victory-player-alive' : 'victory-player-dead';
                const statusIcon = player.alive ? '🟢' : '💀';
                
                victoryHTML += `
                    <div class="victory-player">
                        <div>
                            <span class="victory-player-name ${statusClass}">${statusIcon} ${player.name}</span>
                            <div class="victory-player-role">${character.name}</div>
                        </div>
                        <div class="${statusClass}">${player.alive ? 'حي' : 'ميت'}</div>
                    </div>
                `;
            });
            
            victoryHTML += `</div>`;
            
            elements.victoryScreen.innerHTML = victoryHTML;
        }

        // دالة إعادة تعيين اللعبة
        function resetGame() {
            clearInterval(gameState.timerInterval);
            
            gameState = {
                players: [],
                currentPage: 'start',
                rolesAssigned: false,
                currentPlayerIndex: 0,
                gamePhase: 'night',
                currentRoleAction: 'mafia',
                timer: 40,
                timerInterval: null,
                selectedPlayer: null,
                votes: {},
                killedTonight: null,
                savedTonight: null,
                investigatedTonight: null,
                sniperTarget: null,
                sniperBullet: true,
                dayResults: [],
                votedPlayers: new Set(),
                totalVotes: 0,
                dayNumber: 1,
                currentActionPlayer: null,
                votingPhase: false,
                playerVotes: {},
                voteHistory: [],
                currentPlayerRole: null,
                votingResults: [],
                executedPlayer: null,
                sniperUsedBullet: false,
                gameWinner: null,
                skipVotes: 0,
                previousPlayers: gameState.previousPlayers,
                timerPaused: false,
                saveVersion: '1.6',
                gameStarted: false,
                editingSaveNameKey: null,
                deletingListKey: null,
                savingListName: ''
            };
        }

        // دالة بدء المؤقت
        function startTimer() {
            clearInterval(gameState.timerInterval);
            gameState.timerPaused = false;
            
            elements.gameTimer.textContent = gameState.timer;
            
            // إظهار أزرار التحكم
            if (elements.pauseTimer) elements.pauseTimer.style.display = 'flex';
            if (elements.resumeTimer) elements.resumeTimer.style.display = 'none';
            
            gameState.timerInterval = setInterval(() => {
                if (!gameState.timerPaused) {
                    gameState.timer--;
                    
                    elements.gameTimer.textContent = gameState.timer;
                    
                    if (gameState.timer <= 0) {
                        clearInterval(gameState.timerInterval);
                        skipNightAction();
                    }
                }
            }, 1000);
        }

        // دالة بدء مؤقت النهار
        function startDayTimer() {
            clearInterval(gameState.timerInterval);
            gameState.timerPaused = false;
            
            elements.dayTimer.textContent = 120;
            gameState.timer = 120;
            
            // إظهار أزرار التحكم
            if (elements.pauseDayTimer) elements.pauseDayTimer.style.display = 'flex';
            if (elements.resumeDayTimer) elements.resumeDayTimer.style.display = 'none';
            
            gameState.timerInterval = setInterval(() => {
                if (!gameState.timerPaused) {
                    gameState.timer--;
                    
                    elements.dayTimer.textContent = gameState.timer;
                    
                    if (gameState.timer <= 0) {
                        clearInterval(gameState.timerInterval);
                        skipDayAction();
                    }
                }
            }, 1000);
        }

        // دالة إيقاف المؤقت
        function pauseTimer() {
            gameState.timerPaused = true;
            if (elements.pauseTimer) elements.pauseTimer.style.display = 'none';
            if (elements.resumeTimer) elements.resumeTimer.style.display = 'flex';
        }

        // دالة استئناف المؤقت
        function resumeTimer() {
            gameState.timerPaused = false;
            if (elements.pauseTimer) elements.pauseTimer.style.display = 'flex';
            if (elements.resumeTimer) elements.resumeTimer.style.display = 'none';
        }

        // دالة إعادة تعيين المؤقت
        function resetTimer() {
            gameState.timer = 40;
            elements.gameTimer.textContent = gameState.timer;
            gameState.timerPaused = false;
            
            if (elements.pauseTimer) elements.pauseTimer.style.display = 'flex';
            if (elements.resumeTimer) elements.resumeTimer.style.display = 'none';
        }

        // دالة إيقاف مؤقت النهار
        function pauseDayTimer() {
            gameState.timerPaused = true;
            if (elements.pauseDayTimer) elements.pauseDayTimer.style.display = 'none';
            if (elements.resumeDayTimer) elements.resumeDayTimer.style.display = 'flex';
        }

        // دالة استئناف مؤقت النهار
        function resumeDayTimer() {
            gameState.timerPaused = false;
            if (elements.pauseDayTimer) elements.pauseDayTimer.style.display = 'flex';
            if (elements.resumeDayTimer) elements.resumeDayTimer.style.display = 'none';
        }

        // دالة إعادة تعيين مؤقت النهار
        function resetDayTimer() {
            gameState.timer = 120;
            elements.dayTimer.textContent = gameState.timer;
            gameState.timerPaused = false;
            
            if (elements.pauseDayTimer) elements.pauseDayTimer.style.display = 'flex';
            if (elements.resumeDayTimer) elements.resumeDayTimer.style.display = 'none';
        }

        // دالة إنشاء النجوم
        function createStars() {
            const starsContainer = document.getElementById('starsContainer');
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                star.style.width = `${Math.random() * 3}px`;
                star.style.height = star.style.width;
                star.style.animationDelay = `${Math.random() * 5}s`;
                starsContainer.appendChild(star);
            }
        }

        // دالة إنشاء تأثيرات الكونفيتي
        function createConfetti() {
            const colors = ['#ff4757', '#4ecdc4', '#54a0ff', '#ff9f43', '#a55eea', '#9b59b6', '#ffd700'];
            
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.classList.add('confetti');
                confetti.style.left = `${Math.random() * 100}%`;
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animation = `confettiFall ${Math.random() * 3 + 2}s linear forwards`;
                confetti.style.animationDelay = `${Math.random() * 2}s`;
                document.body.appendChild(confetti);
                
                setTimeout(() => {
                    confetti.remove();
                }, 5000);
            }
        }

        // دالة عرض الرسائل
        function showMessage(message, type = 'success') {
            const messageEl = document.createElement('div');
            messageEl.classList.add('message', type);
            messageEl.textContent = message;
            document.body.appendChild(messageEl);
            
            setTimeout(() => {
                messageEl.remove();
            }, 5000);
        }

        // دالة عرض شخصيات التعليمات
        function displayTutorialCharacters() {
            elements.tutorialCharactersGrid.innerHTML = '';
            
            characters.forEach(character => {
                const characterCard = document.createElement('div');
                characterCard.classList.add('character-card', character.color);
                characterCard.innerHTML = `
                    <div class="character-header">
                        <div class="character-icon-large" style="--role-color: var(--${character.color});">
                            <i class="fas ${character.icon}" style="color: var(--${character.color});"></i>
                        </div>
                        <div class="character-name">${character.name}</div>
                    </div>
                    <div class="character-description">${character.description}</div>
                    <div class="character-details">
                        ${character.details.map(detail => `
                            <div class="detail-item">
                                <i class="fas fa-circle detail-icon"></i>
                                <span>${detail}</span>
                            </div>
                        `).join('')}
                    </div>
                `;
                
                characterCard.addEventListener('click', () => {
                    const details = characterCard.querySelector('.character-details');
                    details.classList.toggle('active');
                });
                
                elements.tutorialCharactersGrid.appendChild(characterCard);
            });
        }

        // ============================================
        // دوال الحفظ والتحميل الجديدة للإصدار 1.6
        // ============================================

        // دالة عرض نافذة إدخال اسم الحفظ
        function showSaveNamePrompt() {
            if (gameState.players.length < 4) {
                showMessage('يجب إضافة 4 لاعبين على الأقل قبل الحفظ', 'error');
                return;
            }
            
            elements.newSaveNameInput.value = gameState.savingListName || `حفظ ${new Date().toLocaleDateString('ar-SA')}`;
            elements.newSaveNameInput.focus();
            document.getElementById('editSaveNameModal').style.display = 'flex';
        }

        // دالة تأكيد تعديل اسم الحفظ
        function confirmEditSaveName() {
            const newSaveName = elements.newSaveNameInput.value.trim();
            
            if (!newSaveName) {
                showMessage('يرجى إدخال اسم للحفظ', 'error');
                return;
            }
            
            if (newSaveName.length > 20) {
                showMessage('اسم الحفظ يجب أن يكون 20 حرفاً كحد أقصى', 'error');
                return;
            }
            
            gameState.savingListName = newSaveName;
            saveNames();
            document.getElementById('editSaveNameModal').style.display = 'none';
        }

        // دالة الحفظ الجديدة مع اسم الحفظ
        function saveNames() {
            try {
                const playerNames = gameState.players.map(player => player.name);
                
                // حفظ البيانات مع اسم الحفظ
                const saveData = {
                    names: playerNames,
                    saveName: gameState.savingListName,
                    date: new Date().toISOString(),
                    version: '1.6'
                };
                
                localStorage.setItem('mafiaSavedNamesData', JSON.stringify(saveData));
                
                // حفظ نسخة احتياطية مع اسم الحفظ
                const backupKey = `mafia_save_backup_${Date.now()}`;
                const backupData = {
                    ...saveData,
                    backupKey: backupKey
                };
                localStorage.setItem(backupKey, JSON.stringify(backupData));
                
                // تنظيف النسخ الاحتياطية القديمة
                cleanupOldBackups();
                
                // عرض تأكيد الحفظ
                document.getElementById('saveConfirmModal').style.display = 'flex';
                
                // تحديث حالة الحفظ
                updateSaveStatus(`تم حفظ "${gameState.savingListName}"`);
                
                // تحديث شارة الحفظ
                if (elements.saveBadge) {
                    elements.saveBadge.style.display = 'block';
                    elements.saveBadge.innerHTML = `
                        <i class="fas fa-save"></i> ${playerNames.length} أسماء محفوظة
                        <div class="save-badge-1_6">${gameState.savingListName}</div>
                    `;
                }
                
                showMessage(`تم حفظ "${gameState.savingListName}" بنجاح!`, 'success');
                
            } catch (error) {
                console.error('Error saving names:', error);
                showMessage('حدث خطأ في حفظ الأسماء', 'error');
            }
        }

        // دالة تنظيف النسخ الاحتياطية القديمة
        function cleanupOldBackups() {
            try {
                const keys = Object.keys(localStorage);
                const backupKeys = keys.filter(key => key.startsWith('mafia_save_backup_'));
                
                // الاحتفاظ بآخر 5 نسخ احتياطية فقط
                if (backupKeys.length > 5) {
                    backupKeys.sort().slice(0, backupKeys.length - 5).forEach(key => {
                        localStorage.removeItem(key);
                    });
                }
            } catch (error) {
                console.error('Error cleaning up backups:', error);
            }
        }

        // دالة عرض نافذة تحميل الأسماء للإصدار 1.6
        function showLoadNamesModal() {
            elements.loadGameOptions.innerHTML = '';
            gameState.editingSaveNameKey = null;
            
            // عرض الحفظ الرئيسي إذا كان موجوداً
            try {
                const savedData = localStorage.getItem('mafiaSavedNamesData');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    
                    if (data && data.names && data.names.length >= 4) {
                        const option = createLoadOption('current', 'mafiaSavedNamesData', data);
                        elements.loadGameOptions.appendChild(option);
                    }
                }
                
                // عرض النسخ الاحتياطية
                const keys = Object.keys(localStorage);
                const backupKeys = keys.filter(key => key.startsWith('mafia_save_backup_'));
                
                backupKeys.sort((a, b) => {
                    const timeA = parseInt(a.split('_').pop());
                    const timeB = parseInt(b.split('_').pop());
                    return timeB - timeA; // الأحدث أولاً
                }).forEach((key, index) => {
                    try {
                        const backupData = JSON.parse(localStorage.getItem(key));
                        if (backupData && backupData.names && backupData.names.length >= 4) {
                            const option = createLoadOption(key, key, backupData, index + 1);
                            elements.loadGameOptions.appendChild(option);
                        }
                    } catch (e) {
                        console.error('Error parsing backup:', key, e);
                    }
                });
                
                if (elements.loadGameOptions.children.length === 0) {
                    elements.loadGameOptions.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 20px;">لا توجد أسماء محفوظة</p>';
                }
                
                document.getElementById('loadGameModal').style.display = 'flex';
                
            } catch (error) {
                console.error('Error loading name options:', error);
                showMessage('حدث خطأ في تحميل قائمة الأسماء', 'error');
            }
        }

        // دالة إنشاء خيار تحميل للإصدار 1.6
        function createLoadOption(radioValue, key, data, backupIndex = null) {
            const option = document.createElement('div');
            option.className = 'load-option';
            option.dataset.key = key;
            option.dataset.names = JSON.stringify(data.names);
            
            const displayNames = data.names.slice(0, 3).join('، ') + (data.names.length > 3 ? '...' : '');
            const saveName = data.saveName || (backupIndex ? `نسخة احتياطية ${backupIndex}` : 'الحفظ الرئيسي');
            const date = data.date ? new Date(data.date).toLocaleString('ar-SA') : 'تاريخ غير معروف';
            
            option.innerHTML = `
                <div class="load-option-content">
                    <input type="radio" name="loadGame" value="${radioValue}" id="load${radioValue}" style="margin-left: 10px;">
                    <label for="load${radioValue}" style="cursor: pointer; flex: 1;">
                        <strong style="color: var(--accent);">${saveName}</strong><br>
                        <small style="color: var(--text-secondary); display: block; margin-top: 5px;">
                            ${data.names.length} أسماء: ${displayNames}<br>
                            <span style="font-size: 0.8rem; opacity: 0.8;">${date}</span>
                        </small>
                    </label>
                </div>
                <div class="load-option-controls">
                    ${radioValue === 'current' ? `
                        <button class="load-option-btn edit" data-key="${key}" title="تعديل اسم الحفظ">
                            <i class="fas fa-edit"></i>
                        </button>
                    ` : ''}
                    <button class="load-option-btn delete" data-key="${key}" title="حذف الحفظ">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            // إضافة مستمعي الأحداث للأزرار
            const editBtn = option.querySelector('.load-option-btn.edit');
            const deleteBtn = option.querySelector('.load-option-btn.delete');
            
            if (editBtn) {
                editBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    showEditSaveNamePrompt(key, data.saveName || 'الحفظ الرئيسي');
                });
            }
            
            deleteBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                const isMainSave = radioValue === 'current';
                const listName = isMainSave ? 'الحفظ الرئيسي' : saveName;
                showDeleteConfirmation(key, listName, data.names.length);
            });
            
            // عند النقر على الخيار نفسه، تحديد الراديو
            option.querySelector('.load-option-content').addEventListener('click', (e) => {
                if (!e.target.closest('.load-option-btn')) {
                    const radio = option.querySelector('input[type="radio"]');
                    radio.checked = true;
                }
            });
            
            return option;
        }

        // دالة عرض نافذة تعديل اسم الحفظ
        function showEditSaveNamePrompt(key, currentName) {
            gameState.editingSaveNameKey = key;
            elements.newSaveNameInput.value = currentName;
            elements.newSaveNameInput.focus();
            document.getElementById('editSaveNameModal').style.display = 'flex';
        }

        // دالة عرض تأكيد الحذف
        function showDeleteConfirmation(key, saveName, count) {
            gameState.deletingListKey = key;
            elements.deleteListName.textContent = `${saveName} - ${count} أسماء`;
            document.getElementById('deleteConfirmModal').style.display = 'flex';
        }

        // دالة تأكيد حذف القائمة
        function confirmDeleteList() {
            if (gameState.deletingListKey) {
                localStorage.removeItem(gameState.deletingListKey);
                
                // إذا كانت القائمة المحذوفة هي القائمة الرئيسية، إزالة شارة الحفظ
                if (gameState.deletingListKey === 'mafiaSavedNamesData') {
                    elements.saveBadge.style.display = 'none';
                }
                
                document.getElementById('deleteConfirmModal').style.display = 'none';
                showMessage('تم حذف الحفظ بنجاح', 'success');
                
                // إعادة تحميل قائمة التحميل
                showLoadNamesModal();
            }
        }

        // دالة تأكيد تحميل الأسماء
        function confirmLoadNames() {
            const selectedOption = document.querySelector('input[name="loadGame"]:checked');
            
            if (!selectedOption) {
                showMessage('يرجى اختيار قائمة أسماء للتحميل', 'error');
                return;
            }
            
            try {
                let data;
                
                if (selectedOption.value === 'current') {
                    const savedData = localStorage.getItem('mafiaSavedNamesData');
                    if (savedData) {
                        data = JSON.parse(savedData);
                    }
                } else {
                    const backupData = localStorage.getItem(selectedOption.value);
                    if (backupData) {
                        data = JSON.parse(backupData);
                    }
                }
                
                if (data && data.names && data.names.length >= 4) {
                    gameState.players = data.names.map(name => ({
                        name: name,
                        role: null,
                        alive: true,
                        votes: 0
                    }));
                    
                    updatePlayerList();
                    document.getElementById('loadGameModal').style.display = 'none';
                    
                    let message = `تم تحميل ${data.names.length} أسماء بنجاح!`;
                    if (data.saveName) {
                        message += ` (${data.saveName})`;
                    }
                    
                    showMessage(message, 'success');
                } else {
                    showMessage('قائمة الأسماء غير صالحة أو أقل من 4 أسماء', 'error');
                }
                
            } catch (error) {
                console.error('Error loading names:', error);
                showMessage('حدث خطأ في تحميل الأسماء', 'error');
            }
        }

        // دالة تحديث حالة الحفظ
        function updateSaveStatus(message) {
            if (elements.saveStatus && elements.saveStatusText) {
                elements.saveStatus.style.display = 'flex';
                elements.saveStatusText.textContent = message;
                
                // إخفاء الرسالة بعد 5 ثوانٍ
                setTimeout(() => {
                    elements.saveStatus.style.display = 'none';
                }, 5000);
            }
        }

        // بدء التطبيق
        window.onload = initGame;
    </script>
</body> 
</html>